#include "stim/diagram/crumble_data.h"

std::string stim_draw_internal::make_crumble_html() {
    std::string result;
    result.append(R"CRUMBLE_PART(<!DOCTYPE html>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(<html lang="en">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(<head>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <meta charset="UTF-8">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <title>Crumble</title>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABgWlDQ1BJQ0MgcHJvZmlsZQAAKJF9kTlIA0EUhj+j4kHEwhQiFluolQFREUuNgggRQlTwKtzdnJBdw27ExlKwDVh4NF6FjbW2FraCIHiAWFpZKdpIWN8kgQQxDgzz8c/8j/f+Ad9RxrTchgGw7JwTnQppC4tLWtMrrfiAAC266WbHI5EwNdfXPXXqvAuqWrXf/bnaYnHXhDpNeMzMOjnhVeGRjVxW8Z7qwkzpMeFz4X5HGhR+VLpR4jfFySKrpgk4c9EJ4YCwlqxio4rNlGMJDwv3xCxb6vsWShxTvKnYyqyb5T7VhP64PT+rdNndTDHNDBE0DNZJkyFHUE5bFJeo3Idq+LuK/oi4DHGlMcUxyRoWetGP+oPf2bqJocFSJX8IGl8876MXmnagkPe872PPK5xA/TNc2RX/2hGMfoqer2g9h9C+BRfXFc3Yhctt6HzK6o5elOpl+xIJeD+Tb1qEjltoXS7lVr7n9AHmJKvwDewfQF9Saq/UmLu5Ord/35Tz+wHVp3JoxsjWZAAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+YKAhYQLxXIct8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAx0lEQVRYw+2XwQ7EIAhEB+N/E76cnkgIa6OuWTFxvTWxdRgKDwmAYu+i+KDKPP62CJjHNYsQ7Psk8iGk7AxdmeGC1e0CvBBbKQK8ljQB5kK2AxcLsJLMdoBKZvQAULMOtk5IR7Dg294+yw4RymUBs3qQ5bHAO34vC8yFPwvSBFhJ3skC35Bq1sHHsKDGKfUX94J46HllGDjd5XnI5WjOXwXQSg5X95eXaaU3zXSjG3XJ79LW1ak1RsX9/qdsldqsPTppo66k6QGRuElWZ7d4CQAAAABJRU)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(5ErkJggg==">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(</head>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(<body style="margin: 0">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                Crumble is a prototype stabilizer circuit editor.<br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnShowExamples">Show Example Circuits</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="https://github.com/quantumlib/Stim/blob/main/glue/crumble/README.md">Read the manual</a>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <canvas id="toolbox" style="width: 370px; height: 110px; border: 1px solid black; margin: 0; padding: 0;">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </canvas>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div id='examples-div' style="border: 1px solid black; margin: 10px; display: none">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="#circuit=Q(0.5,2.5)0;Q(1,1)1;Q(1,2)2;Q(1,3)3;Q(1.5,0.5)4;Q(1.5,1.5)5;Q(1.5,2.5)6;Q(2,1)7;Q(2,2)8;Q(2,3)9;Q(2.5,1.5)10;Q(2.5,2.5)11;Q(2.5,3.5)12;Q(3,1)13;Q(3,2)14;Q(3,3)15;Q(3.5,1.5)16;POLYGON(0,0,1,0.5)2_8_9_3;POLYGON(0,0,1,0.5)7_13_14_8;POLYGON(0,0,1,0.5)15_9;POLYGON(0,0,1,0.5)7_1;POLYGON(1,0,0,0.5)1_7_8_2;POLYGON(1,0,0,0.5)8_14_15_9;POLYGON(1,0,0,0.5)13_14;POLYGON(1,0,0,0.5)2_3;TICK;R_10_6_12_4_1_2_3_7_8_9_13_14_15;RX_5_11_16_0;MARKX(0)5;MARKZ(1)15_9_12;TICK;CX_5_1_7_10_2_6_11_8_16_13_9_12;TICK;CX_5_7_8_10_11_14_1_4_3_6_0_2;TICK;CX_11_9_8_6_5_2_13_10_16_14_15_12;TICK;CX_5_8_14_10_0_3_9_6_7_4_11_15;TICK;M_10_6_12_4;MX_5_11_0_16;MARKX(0)5;MARKZ(1)12;TICK;R_10_6_12_4;RX_5_11_16_0;MARKX(0)5;TICK;CX_5_1_7_10_2_6_11_8_16_13_9_12;TICK;CX_5_7_8_10_11_14_1_4_3_6_0_2;TICK;CX_11_9_8_6_5_2_13_10_16_14_15_12;TICK;CX_5_8_14_10_0_3_9_6_7_4_11_15;TICK;M_10_6_12_4_1_2_3_7_8_9_13_14_15;MX_5_11_0_16;MARKX(0)5">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                    Example: Surface Code (d=3,r=2)
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </a><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="#circuit=Q(1,1)0;Q(1,2)1;Q(1,3)2;Q(1,4)3;Q(1,5)4;Q(1,6)5;Q(1,7)6;Q(2,1)7;Q(2,2)8;Q(2,3)9;Q(2,4)10;Q(2,5)11;Q(2,6)12;Q(2,7)13;Q(3,1)14;Q(3,2)15;Q(3,3)16;Q(3,4)17;Q(3,5)18;Q(3,6)19;Q(3,7)20;Q(4,1)21;Q(4,2)22;Q(4,3)23;Q(4,4)24;Q(4,5)25;Q(4,6)26;Q(4,7)27;Q(5,1)28;Q(5,2)29;Q(5,3)30;Q(5,4)31;Q(5,5)32;Q(5,6)33;Q(5,7)34;Q(6,1)35;Q(6,2)36;Q(6,3)37;Q(6,4)38;Q(6,5)39;Q(6,6)40;Q(6,7)41;Q(7,1)42;Q(7,2)43;Q(7,3)44;Q(7,4)45;Q(7,5)46;Q(7,6)47;Q(7,7)48;POLYGON(0,0,1,0.5)0_7_14_21_28_35_42_43_36_29_22_15_8_1;POLYGON(1,0,0,0.5)0_7_13_6;TICK;R_0_1_2_3_4_5_6_7_8_9_10_11_12_13_14_15_16_17_18_19_20_21_22_23_24_25_26_27_28_29_30_31_32_33_34_35_36_37_38_39_40_41_42_43_44_45_46_47_48;MARKZ(0)6_13_20_27_34_41_48;TICK;MZZ_0_1_7_8_14_15_21_22_28_29_35_36_2_3_9_10_16_17_23_24_30_31_37_38_4_5_11_12_18_19_25_26_32_33_39_40_42_43_44_45_46_47;TICK;MXX_0_7_1_8_2_9_3_10_4_11_5_12_6_13_14_21_15_22_16_23_17_24_18_25_19_26_20_27_28_35_29_36_30_37_31_38_32_39_33_40_34_41;MARKX(1)14_15_16_17_18_19_20_21_22_23_24_25_26_27;TIC)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(K;MZZ_1_2_8_9_15_16_22_23_29_30_36_37_3_4_10_11_17_18_24_25_31_32_38_39_5_6_12_13_19_20_26_27_33_34_40_41_43_44_45_46_47_48;TICK;MXX_7_14_8_15_9_16_10_17_11_18_12_19_13_20_21_28_22_29_23_30_24_31_25_32_26_33_27_34_35_42_36_43_37_44_38_45_39_46_40_47_41_48;TICK;MZZ_0_1_7_8_14_15_21_22_28_29_35_36_2_3_9_10_16_17_23_24_30_31_37_38_4_5_11_12_18_19_25_26_32_33_39_40_42_43_44_45_46_47;TICK;MXX_0_7_1_8_2_9_3_10_4_11_5_12_6_13_14_21_15_22_16_23_17_24_18_25_19_26_20_27_28_35_29_36_30_37_31_38_32_39_33_40_34_41;MARKX(1)14_15_16_17_18_19_20_21_22_23_24_25_26_27;TICK;MZZ_1_2_8_9_15_16_22_23_29_30_36_37_3_4_10_11_17_18_24_25_31_32_38_39_5_6_12_13_19_20_26_27_33_34_40_41_43_44_45_46_47_48;TICK;MXX_7_14_8_15_9_16_10_17_11_18_12_19_13_20_21_28_22_29_23_30_24_31_25_32_26_33_27_34_35_42_36_43_37_44_38_45_39_46_40_47_41_48;TICK;M_0_1_2_3_4_5_6_7_8_9_10_11_12_13_14_15_16_17_18_19_20_21_22_23_24_25_26_27_28_29_30_31_32_33_34_35_36_37_38_39_40_41_42_43_44_45_46_47_48;MARKZ(0)6_13_20_27_34_41_48">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                    Example: Bacon Shor Code (d=7,r=2)
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </a><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="#circuit=Q(0,0)0;Q(0,1)1;Q(0,2)2;Q(0,3)3;Q(0,4)4;Q(0,5)5;Q(0,6)6;Q(0.5,0.5)7;Q(0.5,1.5)8;Q(0.5,2.5)9;Q(0.5,3.5)10;Q(0.5,4.5)11;Q(0.5,5.5)12;Q(0.5,6.5)13;Q(1,0)14;Q(1,1)15;Q(1,2)16;Q(1,3)17;Q(1,4)18;Q(1,5)19;Q(1,6)20;Q(1.5,0.5)21;Q(1.5,1.5)22;Q(1.5,2.5)23;Q(1.5,3.5)24;Q(1.5,4.5)25;Q(1.5,5.5)26;Q(1.5,6.5)27;Q(2,0)28;Q(2,1)29;Q(2,2)30;Q(2,3)31;Q(2,4)32;Q(2,5)33;Q(2,6)34;Q(2.5,0.5)35;Q(2.5,1.5)36;Q(2.5,2.5)37;Q(2.5,3.5)38;Q(2.5,4.5)39;Q(2.5,5.5)40;Q(2.5,6.5)41;Q(3,0)42;Q(3,1)43;Q(3,2)44;Q(3,3)45;Q(3,4)46;Q(3,5)47;Q(3,6)48;Q(3.5,0.5)49;Q(3.5,1.5)50;Q(3.5,2.5)51;Q(3.5,3.5)52;Q(3.5,4.5)53;Q(3.5,5.5)54;Q(3.5,6.5)55;Q(4,0)56;Q(4,1)57;Q(4,2)58;Q(4,3)59;Q(4,4)60;Q(4,5)61;Q(4,6)62;Q(4.5,0.5)63;Q(4.5,1.5)64;Q(4.5,2.5)65;Q(4.5,3.5)66;Q(4.5,4.5)67;Q(4.5,5.5)68;Q(4.5,6.5)69;Q(5,0)70;Q(5,1)71;Q(5,2)72;Q(5,3)73;Q(5,4)74;Q(5,5)75;Q(5,6)76;Q(5.5,0.5)77;Q(5.5,1.5)78;Q(5.5,2.5)79;Q(5.5,3.5)80;Q(5.5,4.5)81;Q(5.5,5.5)82;Q(5.5,6.5)83;Q(6,0)84;Q(6,1)85;Q(6,2)86;Q(6,3)87;Q(6,4)88;Q(6,5)89;Q(6,6)90;Q(6.5,0.5)91;)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(Q(6.5,1.5)92;Q(6.5,2.5)93;Q(6.5,3.5)94;Q(6.5,4.5)95;Q(6.5,5.5)96;POLYGON(0,0,1,0.5)59_66_60_52;POLYGON(0,0,1,0.5)58_65_59_51;POLYGON(0,0,1,0.5)45_52_46_38;POLYGON(0,0,1,0.5)44_51_45_37;POLYGON(0,0,1,0.5)31_38_32_24;POLYGON(0,0,1,0.5)30_37_31_23;POLYGON(0,0,1,0.5)15_22_16_8;POLYGON(0,0,1,0.5)14_21_15_7;POLYGON(0,0,1,0.5)29_36_30_22;POLYGON(0,0,1,0.5)43_50_44_36;POLYGON(0,0,1,0.5)57_64_58_50;POLYGON(0,0,1,0.5)71_78_72_64;POLYGON(0,0,1,0.5)72_79_73_65;POLYGON(0,0,1,0.5)73_80_74_66;POLYGON(0,0,1,0.5)74_81_75_67;POLYGON(0,0,1,0.5)75_82_76_68;POLYGON(0,0,1,0.5)32_39_33_25;POLYGON(0,0,1,0.5)33_40_34_26;POLYGON(0,0,1,0.5)46_53_47_39;POLYGON(0,0,1,0.5)60_67_61_53;POLYGON(0,0,1,0.5)61_68_62_54;POLYGON(0,0,1,0.5)47_54_48_40;POLYGON(0,0,1,0.5)1_8_2;POLYGON(0,0,1,0.5)16_23_17_9;POLYGON(0,0,1,0.5)2_9_3;POLYGON(0,0,1,0.5)17_24_18_10;POLYGON(0,0,1,0.5)3_10_4;POLYGON(0,0,1,0.5)18_25_19_11;POLYGON(0,0,1,0.5)4_11_5;POLYGON(0,0,1,0.5)19_26_20_12;POLYGON(0,0,1,0.5)5_12_6;POLYGON(0,0,1,0.5)0_7_1;POLYGON(0,0,1,0.5)28_35_29_21;POLYG)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ON(0,0,1,0.5)42_49_43_35;POLYGON(0,0,1,0.5)56_63_57_49;POLYGON(0,0,1,0.5)70_77_71_63;POLYGON(0,0,1,0.5)84_91_85_77;POLYGON(0,0,1,0.5)91;POLYGON(0,0,1,0.5)85_92_86_78;POLYGON(0,0,1,0.5)92;POLYGON(0,0,1,0.5)86_93_87_79;POLYGON(0,0,1,0.5)93;POLYGON(0,0,1,0.5)87_94_88_80;POLYGON(0,0,1,0.5)94;POLYGON(0,0,1,0.5)88_95_89_81;POLYGON(0,0,1,0.5)95;POLYGON(0,0,1,0.5)89_96_90_82;POLYGON(0,0,1,0.5)96;POLYGON(1,0,0,0.5)36_44_37_30;POLYGON(1,0,0,0.5)50_58_51_44;POLYGON(1,0,0,0.5)38_46_39_32;POLYGON(1,0,0,0.5)52_60_53_46;POLYGON(1,0,0,0.5)51_59_52_45;POLYGON(1,0,0,0.5)37_45_38_31;POLYGON(1,0,0,0.5)23_31_24_17;POLYGON(1,0,0,0.5)22_30_23_16;POLYGON(1,0,0,0.5)7_15_8_1;POLYGON(1,0,0,0.5)21_29_22_15;POLYGON(1,0,0,0.5)64_72_65_58;POLYGON(1,0,0,0.5)78_86_79_72;POLYGON(1,0,0,0.5)65_73_66_59;POLYGON(1,0,0,0.5)79_87_80_73;POLYGON(1,0,0,0.5)66_74_67_60;POLYGON(1,0,0,0.5)80_88_81_74;POLYGON(1,0,0,0.5)81_89_82_75;POLYGON(1,0,0,0.5)82_90_83_76;POLYGON(1,0,0,0.5)25_33_26_19;POLYGON(1,0,0,0.5)39_47_40_33;POLYGON(1,0,0,0.5)67_75_68_61;POLYGO)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(N(1,0,0,0.5)53_61_54_47;POLYGON(1,0,0,0.5)24_32_25_18;POLYGON(1,0,0,0.5)8_16_9_2;POLYGON(1,0,0,0.5)9_17_10_3;POLYGON(1,0,0,0.5)10_18_11_4;POLYGON(1,0,0,0.5)11_19_12_5;POLYGON(1,0,0,0.5)0_14_7;POLYGON(1,0,0,0.5)14_28_21;POLYGON(1,0,0,0.5)35_43_36_29;POLYGON(1,0,0,0.5)28_42_35;POLYGON(1,0,0,0.5)49_57_50_43;POLYGON(1,0,0,0.5)42_56_49;POLYGON(1,0,0,0.5)63_71_64_57;POLYGON(1,0,0,0.5)56_70_63;POLYGON(1,0,0,0.5)77_85_78_71;POLYGON(1,0,0,0.5)70_84_77;POLYGON(1,0,0,0.5)83;POLYGON(1,0,0,0.5)68_76_69_62;POLYGON(1,0,0,0.5)69;POLYGON(1,0,0,0.5)54_62_55_48;POLYGON(1,0,0,0.5)55;POLYGON(1,0,0,0.5)40_48_41_34;POLYGON(1,0,0,0.5)41;POLYGON(1,0,0,0.5)26_34_27_20;POLYGON(1,0,0,0.5)27;POLYGON(1,0,0,0.5)12_20_13_6;POLYGON(1,0,0,0.5)13;TICK;R_8_10_12_21_23_25_36_38_40_49_51_53_64_66_68_77_79_81_91_92_93_94_95_96_0_1_2_3_4_5_6_14_15_16_17_18_19_20_28_29_30_31_32_33_34_42_43_44_45_46_47_48_56_57_58_59_60_61_62_70_71_72_73_74_75_76_84_85_86_87_88_89_90;RX_7_9_11_13_22_24_26_27_35_37_39_41_50_52_54_55_63_65_67_69_78_80_82_83;MARKX(0)37;)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(MARKZ(1)40;MARKZ(2)59_60_66_73_74;MARKZ(3)0_14_28_42_56_70_84;TICK;CX_1_8_3_10_5_12_7_0_9_2_11_4_13_6_14_21_16_23_18_25_22_15_24_17_26_19_29_36_31_38_33_40_35_28_37_30_39_32_41_34_42_49_44_51_46_53_50_43_52_45_54_47_57_64_59_66_61_68_63_56_65_58_67_60_69_62_70_77_72_79_74_81_78_71_80_73_82_75_85_92_87_94_89_96;TICK;CX_2_8_4_10_6_12_7_14_9_16_11_18_13_20_15_21_17_23_19_25_22_29_24_31_26_33_30_36_32_38_34_40_35_42_37_44_39_46_41_48_43_49_45_51_47_53_50_57_52_59_54_61_58_64_60_66_62_68_63_70_65_72_67_74_69_76_71_77_73_79_75_81_78_85_80_87_82_89_86_92_88_94_90_96;TICK;CX_1_7_3_9_5_11_8_15_10_17_12_19_16_22_18_24_20_26_21_28_23_30_25_32_27_34_29_35_31_37_33_39_36_43_38_45_40_47_44_50_46_52_48_54_49_56_51_58_53_60_55_62_57_63_59_65_61_67_64_71_66_73_68_75_72_78_74_80_76_82_77_84_79_86_81_88_83_90_85_91_87_93_89_95;TICK;CX_0_7_2_9_4_11_8_1_10_3_12_5_15_22_17_24_19_26_21_14_23_16_25_18_27_20_28_35_30_37_32_39_36_29_38_31_40_33_43_50_45_52_47_54_49_42_51_44_53_46_55_48_56_63_58_65_60_67_64_57_66_59_68_61_71_78_73_80_7)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(5_82_77_70_79_72_81_74_83_76_84_91_86_93_88_95;TICK;M_7_9_11_22_24_26_35_37_39_50_52_54_63_65_67_78_80_82_91_92_93_94_95_96;MX_8_10_12_13_21_23_25_27_36_38_40_41_49_51_53_55_64_66_68_69_77_79_81_83;MARKX(0)36;MARKZ(1)26;MARKZ(2)80;TICK;R_7_9_11_22_24_26_35_37_39_50_52_54_63_65_67_78_80_82_91_92_93_94_95_96;RX_8_10_12_13_21_23_25_27_36_38_40_41_49_51_53_55_64_66_68_69_77_79_81_83;MARKX(0)36;MARKZ(1)26;TICK;CX_0_7_2_9_4_11_8_1_10_3_12_5_15_22_17_24_19_26_21_14_23_16_25_18_27_20_28_35_30_37_32_39_36_29_38_31_40_33_43_50_45_52_47_54_49_42_51_44_53_46_55_48_56_63_58_65_60_67_64_57_66_59_68_61_71_78_73_80_75_82_77_70_79_72_81_74_83_76_84_91_86_93_88_95;TICK;CX_1_7_3_9_5_11_8_15_10_17_12_19_16_22_18_24_20_26_21_28_23_30_25_32_27_34_29_35_31_37_33_39_36_43_38_45_40_47_44_50_46_52_48_54_49_56_51_58_53_60_55_62_57_63_59_65_61_67_64_71_66_73_68_75_72_78_74_80_76_82_77_84_79_86_81_88_83_90_85_91_87_93_89_95;TICK;CX_2_8_4_10_6_12_7_14_9_16_11_18_13_20_15_21_17_23_19_25_22_29_24_31_26_33_30_36_32_38_34_40_35_42_37_44_39_46)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_41_48_43_49_45_51_47_53_50_57_52_59_54_61_58_64_60_66_62_68_63_70_65_72_67_74_69_76_71_77_73_79_75_81_78_85_80_87_82_89_86_92_88_94_90_96;TICK;CX_1_8_3_10_5_12_7_0_9_2_11_4_13_6_14_21_16_23_18_25_22_15_24_17_26_19_29_36_31_38_33_40_35_28_37_30_39_32_41_34_42_49_44_51_46_53_50_43_52_45_54_47_57_64_59_66_61_68_63_56_65_58_67_60_69_62_70_77_72_79_74_81_78_71_80_73_82_75_85_92_87_94_89_96;TICK;M_8_10_12_21_23_25_36_38_40_49_51_53_64_66_68_77_79_81_91_92_93_94_95_96;MX_7_9_11_13_22_24_26_27_35_37_39_41_50_52_54_55_63_65_67_69_78_80_82_83;MARKX(0)37;MARKZ(1)40;TICK;R_8_10_12_21_23_25_36_38_40_49_51_53_64_66_68_77_79_81_91_92_93_94_95_96;RX_7_9_11_13_22_24_26_27_35_37_39_41_50_52_54_55_63_65_67_69_78_80_82_83;TICK;CX_1_8_3_10_5_12_7_0_9_2_11_4_13_6_14_21_16_23_18_25_22_15_24_17_26_19_29_36_31_38_33_40_35_28_37_30_39_32_41_34_42_49_44_51_46_53_50_43_52_45_54_47_57_64_59_66_61_68_63_56_65_58_67_60_69_62_70_77_72_79_74_81_78_71_80_73_82_75_85_92_87_94_89_96;TICK;CX_2_8_4_10_6_12_7_14_9_16_11_18_13_20_15_21_17_23_19_25)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_22_29_24_31_26_33_30_36_32_38_34_40_35_42_37_44_39_46_41_48_43_49_45_51_47_53_50_57_52_59_54_61_58_64_60_66_62_68_63_70_65_72_67_74_69_76_71_77_73_79_75_81_78_85_80_87_82_89_86_92_88_94_90_96;TICK;CX_1_7_3_9_5_11_8_15_10_17_12_19_16_22_18_24_20_26_21_28_23_30_25_32_27_34_29_35_31_37_33_39_36_43_38_45_40_47_44_50_46_52_48_54_49_56_51_58_53_60_55_62_57_63_59_65_61_67_64_71_66_73_68_75_72_78_74_80_76_82_77_84_79_86_81_88_83_90_85_91_87_93_89_95;TICK;CX_0_7_2_9_4_11_8_1_10_3_12_5_15_22_17_24_19_26_21_14_23_16_25_18_27_20_28_35_30_37_32_39_36_29_38_31_40_33_43_50_45_52_47_54_49_42_51_44_53_46_55_48_56_63_58_65_60_67_64_57_66_59_68_61_71_78_73_80_75_82_77_70_79_72_81_74_83_76_84_91_86_93_88_95;TICK;M_7_9_11_22_24_26_35_37_39_50_52_54_63_65_67_78_80_82_91_92_93_94_95_96;MX_8_10_12_13_21_23_25_27_36_38_40_41_49_51_53_55_64_66_68_69_77_79_81_83;TICK;R_7_9_11_22_24_26_35_37_39_50_52_54_63_65_67_78_80_82_91_92_93_94_95_96;RX_8_10_12_13_21_23_25_27_36_38_40_41_49_51_53_55_64_66_68_69_77_79_81_83;TICK;CX_0_7_2_9_4_11_8_1)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_10_3_12_5_15_22_17_24_19_26_21_14_23_16_25_18_27_20_28_35_30_37_32_39_36_29_38_31_40_33_43_50_45_52_47_54_49_42_51_44_53_46_55_48_56_63_58_65_60_67_64_57_66_59_68_61_71_78_73_80_75_82_77_70_79_72_81_74_83_76_84_91_86_93_88_95;TICK;CX_1_7_3_9_5_11_8_15_10_17_12_19_16_22_18_24_20_26_21_28_23_30_25_32_27_34_29_35_31_37_33_39_36_43_38_45_40_47_44_50_46_52_48_54_49_56_51_58_53_60_55_62_57_63_59_65_61_67_64_71_66_73_68_75_72_78_74_80_76_82_77_84_79_86_81_88_83_90_85_91_87_93_89_95;TICK;CX_2_8_4_10_6_12_7_14_9_16_11_18_13_20_15_21_17_23_19_25_22_29_24_31_26_33_30_36_32_38_34_40_35_42_37_44_39_46_41_48_43_49_45_51_47_53_50_57_52_59_54_61_58_64_60_66_62_68_63_70_65_72_67_74_69_76_71_77_73_79_75_81_78_85_80_87_82_89_86_92_88_94_90_96;TICK;CX_1_8_3_10_5_12_7_0_9_2_11_4_13_6_14_21_16_23_18_25_22_15_24_17_26_19_29_36_31_38_33_40_35_28_37_30_39_32_41_34_42_49_44_51_46_53_50_43_52_45_54_47_57_64_59_66_61_68_63_56_65_58_67_60_69_62_70_77_72_79_74_81_78_71_80_73_82_75_85_92_87_94_89_96;TICK;M_8_10_12_21_23_25_36_38_40_49_51_)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(53_64_66_68_77_79_81_91_92_93_94_95_96_0_1_2_3_4_5_6_14_15_16_17_18_19_20_28_29_30_31_32_33_34_42_43_44_45_46_47_48_56_57_58_59_60_61_62_70_71_72_73_74_75_76_84_85_86_87_88_89_90;MX_7_9_11_13_22_24_26_27_35_37_39_41_50_52_54_55_63_65_67_69_78_80_82_83;MARKZ(3)0_14_28_42_56_70_84">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                    Example: Three Coupler Surface Code (d=7,r=4)
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </a><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="#circuit=Q(0,2)0;Q(0,4)1;Q(0,6)2;Q(0.5,0.5)3;Q(0.5,1.5)4;Q(0.5,2.5)5;Q(0.5,3.5)6;Q(0.5,4.5)7;Q(0.5,5.5)8;Q(0.5,6.5)9;Q(1,0)10;Q(1,1)11;Q(1,2)12;Q(1,3)13;Q(1,4)14;Q(1,5)15;Q(1,6)16;Q(1.5,0.5)17;Q(1.5,1.5)18;Q(1.5,2.5)19;Q(1.5,3.5)20;Q(1.5,4.5)21;Q(1.5,5.5)22;Q(1.5,6.5)23;Q(2,0)24;Q(2,1)25;Q(2,2)26;Q(2,3)27;Q(2,4)28;Q(2,5)29;Q(2,6)30;Q(2,7)31;Q(2.5,0.5)32;Q(2.5,1.5)33;Q(2.5,2.5)34;Q(2.5,3.5)35;Q(2.5,4.5)36;Q(2.5,5.5)37;Q(2.5,6.5)38;Q(3,0)39;Q(3,1)40;Q(3,2)41;Q(3,3)42;Q(3,4)43;Q(3,5)44;Q(3,6)45;Q(3.5,0.5)46;Q(3.5,1.5)47;Q(3.5,2.5)48;Q(3.5,3.5)49;Q(3.5,4.5)50;Q(3.5,5.5)51;Q(3.5,6.5)52;Q(4,0)53;Q(4,1)54;Q(4,2)55;Q(4,3)56;Q(4,4)57;Q(4,5)58;Q(4,6)59;Q(4,7)60;Q(4.5,0.5)61;Q(4.5,1.5)62;Q(4.5,2.5)63;Q(4.5,3.5)64;Q(4.5,4.5)65;Q(4.5,5.5)66;Q(4.5,6.5)67;Q(5,0)68;Q(5,1)69;Q(5,2)70;Q(5,3)71;Q(5,4)72;Q(5,5)73;Q(5,6)74;Q(5.5,0.5)75;Q(5.5,1.5)76;Q(5.5,2.5)77;Q(5.5,3.5)78;Q(5.5,4.5)79;Q(5.5,5.5)80;Q(5.5,6.5)81;Q(6,0)82;Q(6,1)83;Q(6,2)84;Q(6,3)85;Q(6,4)86;Q(6,5)87;Q(6,6)88;Q(6,7)89;Q(6.5,0.5)90;Q(6.5,1.5)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART()91;Q(6.5,2.5)92;Q(6.5,3.5)93;Q(6.5,4.5)94;Q(6.5,5.5)95;Q(6.5,6.5)96;Q(7,1)97;Q(7,2)98;Q(7,3)99;Q(7,4)100;Q(7,5)101;Q(7,6)102;POLYGON(0,0,1,0.5)3_17_18_4;POLYGON(0,0,1,0.5)5_19_20_6;POLYGON(0,0,1,0.5)7_21_22_8;POLYGON(0,0,1,0.5)18_33_34_19;POLYGON(0,0,1,0.5)20_35_36_21;POLYGON(0,0,1,0.5)22_37_38_23;POLYGON(0,0,1,0.5)32_46_47_33;POLYGON(0,0,1,0.5)34_48_49_35;POLYGON(0,0,1,0.5)36_50_51_37;POLYGON(0,0,1,0.5)47_62_63_48;POLYGON(0,0,1,0.5)49_64_65_50;POLYGON(0,0,1,0.5)51_66_67_52;POLYGON(0,0,1,0.5)61_75_76_62;POLYGON(0,0,1,0.5)63_77_78_64;POLYGON(0,0,1,0.5)65_79_80_66;POLYGON(0,0,1,0.5)76_91_92_77;POLYGON(0,0,1,0.5)78_93_94_79;POLYGON(0,0,1,0.5)80_95_96_81;POLYGON(0,0,1,0.75)4_5;POLYGON(0,0,1,0.75)6_7;POLYGON(0,0,1,0.75)8_9;POLYGON(0,0,1,0.75)90_91;POLYGON(0,0,1,0.75)92_93;POLYGON(0,0,1,0.75)94_95;POLYGON(1,0,0,0.5)4_18_19_5;POLYGON(1,0,0,0.5)6_20_21_7;POLYGON(1,0,0,0.5)8_22_23_9;POLYGON(1,0,0,0.5)17_32_33_18;POLYGON(1,0,0,0.5)19_34_35_20;POLYGON(1,0,0,0.5)21_36_37_22;POLYGON(1,0,0,0.5)33_47_48_34;POLYGON(1,0,0,0.)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(5)35_49_50_36;POLYGON(1,0,0,0.5)37_51_52_38;POLYGON(1,0,0,0.5)46_61_62_47;POLYGON(1,0,0,0.5)48_63_64_49;POLYGON(1,0,0,0.5)50_65_66_51;POLYGON(1,0,0,0.5)62_76_77_63;POLYGON(1,0,0,0.5)64_78_79_65;POLYGON(1,0,0,0.5)66_80_81_67;POLYGON(1,0,0,0.5)75_90_91_76;POLYGON(1,0,0,0.5)77_92_93_78;POLYGON(1,0,0,0.5)79_94_95_80;POLYGON(1,0,0,0.75)17_3;POLYGON(1,0,0,0.75)38_23;POLYGON(1,0,0,0.75)46_32;POLYGON(1,0,0,0.75)67_52;POLYGON(1,0,0,0.75)75_61;POLYGON(1,0,0,0.75)96_81;TICK;R_0_1_2_11_13_15_26_28_30_40_42_44_55_57_59_69_71_73_84_86_88_97_98_99_100_101_102;RX_10_12_14_16_24_25_27_29_31_39_41_43_45_53_54_56_58_60_68_70_72_74_82_83_85_87_89;MARKX(0)41;MARKX(1)70;MARKX(3)64_65_72_78_79;MARKZ(0)42;MARKZ(2)65_66_79_80_73;TICK;CX_10_3_12_5_14_7_16_9_25_18_27_20_29_22_39_32_41_34_43_36_45_38_54_47_56_49_58_51_68_61_70_63_72_65_74_67_83_76_85_78_87_80_4_11_6_13_8_15_19_26_21_28_23_30_33_40_35_42_37_44_48_55_50_57_52_59_62_69_64_71_66_73_77_84_79_86_81_88_91_97_93_99_95_101;TICK;CX_10_17_12_19_14_21_16_23_25_33_27_35_29_37_39_46_)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(41_48_43_50_45_52_54_62_56_64_58_66_68_75_70_77_72_79_74_81_83_91_85_93_87_95_3_11_5_13_7_15_18_26_20_28_22_30_32_40_34_42_36_44_47_55_49_57_51_59_61_69_63_71_65_73_76_84_78_86_80_88_90_97_92_99_94_101;TICK;CX_17_25_33_41_46_54_48_56_62_70_64_72_75_83_77_85_79_87_91_98_93_100_95_102_24_32_40_47_53_61_55_63_69_76_71_78_82_90_84_92_86_94_12_4_14_6_16_8_27_19_29_21_31_23_43_35_45_37_58_50_60_52_74_66_89_81_5_0_7_1_9_2_20_13_22_15_36_28_38_30_51_44_67_59;XCY_11_18_26_34_42_49_57_65_73_80_88_96;TICK;CX_32_39_47_54_61_68_63_70_76_83_78_85_92_98_94_100_24_17_40_33_53_46_55_48_69_62_71_64_82_75_84_77_86_79_97_91_99_93_101_95_12_18_14_20_16_22_27_34_29_36_31_38_43_49_45_51_58_65_60_67_74_80_89_96_4_0_6_1_8_2_19_13_21_15_35_28_37_30_50_44_66_59;TICK;XCY_18_25_34_41_49_56_65_72_80_87_96_102;TICK;H_17_32_33_46_47_48_61_62_63_64_75_76_77_78_79_90_91_92_93_94_95_10_24_25_39_40_41_53_54_55_56_68_69_70_71_72_82_83_84_85_86_87_97_98_99_100_101_102;SQRT_X_11_26_42_57_73_88;TICK;M_0_1_2_10_11_13_15_24_26_28_30_39_40_42_44_53_55)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_57_59_68_69_71_73_82_84_86_88;MX_12_14_16_25_27_29_31_41_43_45_54_56_58_60_70_72_74_83_85_87_89_97_98_99_100_101_102;MY_3;MARKX(0)41_56;MARKX(2)87;MARKZ(0)42;MARKZ(1)71;MARKZ(2)73;MARKZ(3)71;TICK;POLYGON(0,0,1,0.5)17_18_4;POLYGON(0,0,1,0.5)5_19_20_6;POLYGON(0,0,1,0.5)7_21_22_8;POLYGON(0,0,1,0.5)18_33_34_19;POLYGON(0,0,1,0.5)20_35_36_21;POLYGON(0,0,1,0.5)22_37_38_23;POLYGON(0,0,1,0.5)32_46_47_33;POLYGON(0,0,1,0.5)34_48_49_35;POLYGON(0,0,1,0.5)36_50_51_37;POLYGON(0,0,1,0.5)47_62_63_48;POLYGON(0,0,1,0.5)49_64_65_50;POLYGON(0,0,1,0.5)51_66_67_52;POLYGON(0,0,1,0.5)61_75_76_62;POLYGON(0,0,1,0.5)63_77_78_64;POLYGON(0,0,1,0.5)65_79_80_66;POLYGON(0,0,1,0.5)76_91_92_77;POLYGON(0,0,1,0.5)78_93_94_79;POLYGON(0,0,1,0.5)80_95_96_81;POLYGON(0,0,1,0.75)4_5;POLYGON(0,0,1,0.75)6_7;POLYGON(0,0,1,0.75)8_9;POLYGON(0,0,1,0.75)32_17;POLYGON(0,0,1,0.75)61_46;POLYGON(0,0,1,0.75)90_75;POLYGON(1,0,0,0.5)4_18_19_5;POLYGON(1,0,0,0.5)6_20_21_7;POLYGON(1,0,0,0.5)8_22_23_9;POLYGON(1,0,0,0.5)17_32_33_18;POLYGON(1,0,0,0.5)19_34_35_20;POLYGON)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART((1,0,0,0.5)21_36_37_22;POLYGON(1,0,0,0.5)33_47_48_34;POLYGON(1,0,0,0.5)35_49_50_36;POLYGON(1,0,0,0.5)37_51_52_38;POLYGON(1,0,0,0.5)46_61_62_47;POLYGON(1,0,0,0.5)48_63_64_49;POLYGON(1,0,0,0.5)50_65_66_51;POLYGON(1,0,0,0.5)62_76_77_63;POLYGON(1,0,0,0.5)64_78_79_65;POLYGON(1,0,0,0.5)66_80_81_67;POLYGON(1,0,0,0.5)75_90_91_76;POLYGON(1,0,0,0.5)77_92_93_78;POLYGON(1,0,0,0.5)79_94_95_80;POLYGON(1,0,0,0.75)38_23;POLYGON(1,0,0,0.75)67_52;POLYGON(1,0,0,0.75)96_81;POLYGON(1,0,0,0.75)91_92;POLYGON(1,0,0,0.75)93_94;POLYGON(1,0,0,0.75)95_96">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                    Example: Surface Code Y Measurement Transition Round (d=7)
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </a><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <a href="#circuit=Q(0,6)0;Q(1,4)1;Q(1,5)2;Q(1,6)3;Q(2,3)4;Q(2,4)5;Q(2,5)6;Q(2,6)7;Q(3,1)8;Q(3,2)9;Q(3,3)10;Q(3,4)11;Q(3,5)12;Q(3,6)13;Q(4,0)14;Q(4,1)15;Q(4,2)16;Q(4,3)17;Q(4,4)18;Q(4,5)19;Q(4,6)20;Q(5,1)21;Q(5,2)22;Q(5,3)23;Q(5,4)24;Q(5,5)25;Q(5,6)26;Q(6,2)27;Q(6,3)28;Q(6,4)29;Q(6,5)30;Q(6,6)31;Q(7,4)32;Q(7,5)33;Q(7,6)34;Q(8,5)35;Q(8,6)36;POLYGON(0,1,1,0.25)16_21_28_23;POLYGON(0,1,1,0.25)30_32_36_34;POLYGON(0,1,1,0.25)11_18_25_20_13_6;POLYGON(1,0,1,0.25)9_16_23_18_11_4;POLYGON(1,0,1,0.25)25_30_34_20;POLYGON(1,0,1,0.25)2_6_13_0;POLYGON(1,1,0,0.25)14_21_16_9;POLYGON(1,1,0,0.25)23_28_32_30_25_18;POLYGON(1,1,0,0.25)4_11_6_2;TICK;R_0_2_6_13_20_25_30_34_36_32_23_28_11_18_4_9_16_21_14;TICK;R_7_31_35_29_5_19_17_27_15;RX_3_26_33_24_1_12_10_22_8;MARKX(0)10;MARKZ(1)17;TICK;CX_3_7_26_31_33_35_24_29_1_5_12_19_10_17_22_27_8_15;TICK;CX_3_2_26_25_33_32_24_23_12_11_10_9_22_21_7_6_31_30_29_28_5_4_19_18_17_16_15_14;TICK;CX_3_0_26_20_33_30_24_18_12_6_10_4_22_16_7_13_31_34_29_32_5_11_19_25_17_23_15_21;TICK;CX_33_3)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(4_24_25_1_2_12_13_10_11_22_23_8_9_35_36_29_30_5_6_19_20_17_18_27_28_15_16;TICK;CX_34_33_25_24_2_1_13_12_11_10_23_22_9_8_36_35_30_29_6_5_20_19_18_17_28_27_16_15;TICK;CX_0_3_20_26_30_33_18_24_6_12_4_10_16_22_13_7_34_31_32_29_11_5_25_19_23_17_21_15;TICK;CX_2_3_25_26_32_33_23_24_11_12_9_10_21_22_6_7_30_31_28_29_4_5_18_19_16_17_14_15;TICK;CX_3_7_26_31_33_35_24_29_1_5_12_19_10_17_22_27_8_15;TICK;M_7_31_35_29_5_19_17_27_15;MX_3_26_33_24_1_12_10_22_8;MARKX(0)8_12;MARKZ(1)17;TICK;R_7_31_35_29_5_19_17_27_15;RX_3_26_33_24_1_12_10_22_8;MARKX(0)10;MARKZ(1)15_19;MARKZ(2)35;TICK;CX_3_7_26_31_33_35_24_29_1_5_12_19_10_17_22_27_8_15;TICK;CX_3_2_26_25_33_32_24_23_12_11_10_9_22_21_7_6_31_30_29_28_5_4_19_18_17_16_15_14;TICK;CX_3_0_26_20_33_30_24_18_12_6_10_4_22_16_7_13_31_34_29_32_5_11_19_25_17_23_15_21;TICK;CX_33_34_24_25_1_2_12_13_10_11_22_23_8_9_35_36_29_30_5_6_19_20_17_18_27_28_15_16;TICK;CX_34_33_25_24_2_1_13_12_11_10_23_22_9_8_36_35_30_29_6_5_20_19_18_17_28_27_16_15;TICK;CX_0_3_20_26_30_33_18_24_6_12_4_10_16_22_13_7_34_31_3)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(2_29_11_5_25_19_23_17_21_15;TICK;CX_2_3_25_26_32_33_23_24_11_12_9_10_21_22_6_7_30_31_28_29_4_5_18_19_16_17_14_15;TICK;CX_3_7_26_31_33_35_24_29_1_5_12_19_10_17_22_27_8_15;TICK;M_7_31_35_29_5_19_17_27_15;MX_3_26_33_24_1_12_10_22_8;MARKX(0)10;MARKZ(1)17;MARKZ(2)35;TICK;M_0_2_6_13_20_25_30_34_36_32_23_28_11_18_4_9_16_21_14;MARKZ(2)36_34_30_32">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                    Example: Color Code (d=5)
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                </a><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnShowHideImportExport">Show Import/Export</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="clear">Clear All</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnClearMarkers">Clear All Pauli Marks</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnClearSelectedMarkers">Clear Selected Marks (space)</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnRedo">Redo (ctrl+Y)</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnUndo">Undo (ctrl+Z)</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnNextLayer">Next Layer (e)</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnPrevLayer">Prev Layer (q)</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnRotate45">Rotate 45 Clockwise ↻ (t)</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnRotate45Counter">Rotate 45 Mathwise ↺ (shift+t)</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div style="display: inline-block">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnTimelineFocus">Set Timeline Focus (L)</button><br>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(                <button id="btnClearTimelineFocus">Clear Timeline Focus</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <textarea id="txtDefaultCircuit" style="display: none">[[[DEFAULT_CIRCUIT_CONTENT_LITERAL]]]</textarea>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <div id="divImportExport" style="display: none">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            <textarea id="txtStimCircuit" style="width: 95vw; height: 300px; background-color: #FFFFB0">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(            </textarea>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <button id="btnExport" style="background-color: red">↑ Export to Stim Circuit ↑</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(        <button id="btnImport" style="background-color: red">↓ Import from Stim Circuit ↓</button>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    </div>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    <canvas id="cvn" style="width: calc(100vw - 32px); height: calc(100vh - 150px); border: 1px solid black; margin: 0; padding: 0;" tabindex="0">
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    </canvas>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(</body>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(</html>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(<script>
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(class h{constructor(t,r,e,i,o,a,n,s,h=void 0){this.name=t,this.t=r,this.i=i,this.o=e,this.h=o,this.l=a,this.v=n,this.u=s,this.M=h}X(t){return new h(this.name,this.t,this.o,this.i,this.h,this.l,this.v,this.u,t)}}function p(r){var e=[];for(let t=0;t<r.length;t++){var i="I".repeat(t),o="I".repeat(r.length-t-1);"X"!==r[t]&&"Y"!==r[t]||e.push(i+"X"+o),"Z"!==r[t]&&"Y"!==r[t]||e.push(i+"Z"+o)}return e}class O{constructor(t,r,e){if(!(t instanceof h))throw new Error("!(gate instanceof Gate)");if(!(r instanceof Float32Array))throw new Error("!(args instanceof Float32Array)");if(!(e instanceof Uint32Array))throw new Error("!(targets instanceof Uint32Array)");this.Z=t,this.R=r,this.Y=e}toString(){return`${this.Z.name}(${[...this.R].join(", ")}) `+[...this.Y].join(" ")}m(){return"M"===this.Z.name||"MX"===this.Z.name||"MY"===this.Z.name||"MR"===this.Z.name||"MRX"===this.Z.name||"MRY"===this.Z.name?this.Y.length:"MXX"===this.Z.name||"MYY"===this.Z.name||"MZZ"===this.Z.name?this.Y.length/2:this.Z.name.startsWith("MPP:")?1:0})CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(I(i){let r=this.Z.h;if(void 0===r){if(this.Z.name.startsWith("M")){let r,e=(r=this.Z.name.startsWith("MPP:")?this.Z.name.substring(4):this.Z.name.substring(1),0);for(let t=0;t<i.length;t++){var o="XYZ".indexOf(i[t]),a="XYZ".indexOf(r[t]);0<=o&&0<=a&&o!==a&&e++}return e%2!=0?"ERR:"+i:i}if(this.Z.name.startsWith("SPP:")||this.Z.name.startsWith("SPP_DAG:")){var t=this.Z.name.startsWith("SPP_DAG:"),n=this.Z.name.substring(t?8:4);let r=0,e="";for(let t=0;t<i.length;t++){var s="IXYZ".indexOf(i[t]),h="IXYZ".indexOf(n[t]);0<s&&0<h&&s!==h&&r++,e+="IXYZ"[s^h]}return r%2!=0?e:i}if("POLYGON"===this.Z.name)return i;throw new Error(this.Z.name)}if(i.length!==this.Z.t)throw new Error("before.length !== this.gate.num_qubits");if(r.has(i))return r.get(i);let e=p(i);var f,l=[0,0];for(f of e=e.map(t=>r.get(t)))for(let t=0;t<i.length;t++)"X"===f[t]&&(l[t]^=1),"Y"===f[t]&&(l[t]^=3),"Z"===f[t]&&(l[t]^=2);let v="";for(let t=0;t<i.length;t++)v+="IXZY"[l[t]];return v}p(t,r){r.save();try{this.Z.u(this,t,r)}finally{r.restore()}}}const )CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_=50,Yt=10,g=-_+Math.floor(_/4)+.5,yt=-_+Math.floor(_/4)+.5;function a(t,r,e){void 0!==r&&void 0!==e&&(t.strokeStyle="black",t.fillStyle="white",t.beginPath(),t.arc(r,e,Yt,0,2*Math.PI),t.fill(),t.stroke(),t.beginPath(),t.moveTo(r,e-Yt),t.lineTo(r,e+Yt),t.stroke(),t.beginPath(),t.moveTo(r-Yt,e),t.lineTo(r+Yt,e),t.stroke())}function n(t,r,e){void 0!==r&&void 0!==e&&(t.strokeStyle="black",t.fillStyle="#AAA",t.beginPath(),t.moveTo(r,e+Yt),t.lineTo(r+Yt,e-Yt),t.lineTo(r-Yt,e-Yt),t.lineTo(r,e+Yt),t.stroke(),t.fill())}function s(t,r,e){void 0!==r&&void 0!==e&&(t.fillStyle="black",t.beginPath(),t.arc(r,e,Yt,0,2*Math.PI),t.fill())}function b(t,r,e){var i;void 0!==r&&void 0!==e&&(t.fillStyle="black",t.strokeStyle="black",t.beginPath(),t.arc(r,e,Yt,0,2*Math.PI),t.fill(),t.stroke(),i=.4*Yt,t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.moveTo(r-i,e-i),t.lineTo(r+i,e+i),t.stroke(),t.moveTo(r-i,e+i),t.lineTo(r+i,e-i),t.stroke(),t.lineWidth=1)}function f(t,r,e){var i;void 0!==r&&void 0!==e&&(t.fillStyle="#888",t.stroke)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(Style="#222",t.beginPath(),t.arc(r,e,Yt,0,2*Math.PI),t.fill(),t.stroke(),i=.4*Yt,t.lineWidth=3,t.strokeStyle="black",t.beginPath(),t.moveTo(r-i,e-i),t.lineTo(r+i,e+i),t.stroke(),t.moveTo(r-i,e+i),t.lineTo(r+i,e-i),t.stroke(),t.lineWidth=1)}function S(t,r,e){var i;void 0!==r&&void 0!==e&&(i=Yt/3,t.strokeStyle="black",t.beginPath(),t.moveTo(r-i,e-i),t.lineTo(r+i,e+i),t.stroke(),t.moveTo(r-i,e+i),t.lineTo(r+i,e-i),t.stroke())}function k(t,r,e){var i;void 0!==r&&void 0!==e&&(i=1.1*Yt,t.strokeRect(r-i,e-i,2*i,2*i))}function mt(t,r,e,i,o){var a,n,s,h,f;void 0===r||void 0===e||void 0===i||void 0===o?(k(t,r,e),k(t,i,o)):i<r||i===r&&o<e?mt(t,i,o,r,e):(n=i-r,h=s=(a=o-e)/(a=Math.sqrt(n*n+a*a))*14,f=-(n=n/a*14),t.beginPath(),t.moveTo(r,e),a<1.1*_?t.lineTo(i,o):t.bezierCurveTo(r+n+h,e+s+f,i-n+h,o-s+f,i,o),t.stroke())}function c(t,r,e,i,o){t.lineWidth=2,t.strokeStyle="black",mt(t,r,e,i,o),t.lineWidth=1}function C(e,i){if(e.beginPath(),0!==i.length){var r=i.length;if(1===r){var[[o,a]]=i;e.arc(o,a,1.7*Yt,0,2*Math.PI)}else if)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART((2===r){var[[o,a],[n,s]]=i,h=n-o,f=s-a,l=(n+o)/2,v=(s+a)/2;let t=-f,r=h;var c=t*t+r*r,c=(2500<c&&(c=50/Math.sqrt(c),t*=c,r*=c),l+.2*t-.2*h),d=v+.2*r-.2*f,w=l+.2*t+.2*h,u=v+.2*r+.2*f,M=l-.2*t-.2*h,X=v-.2*r-.2*f,l=l-.2*t+.2*h,h=v-.2*r+.2*f;e.moveTo(o,a),e.bezierCurveTo(c,d,w,u,n,s),e.bezierCurveTo(l,h,M,X,o,a)}else{var[v,f]=i[r-1];e.moveTo(v,f);for(let t=0;t<r;t++){var[Z,R]=i[t];e.lineTo(Z,R)}}}}function It(r,e,i){let o,a,n,s;if(r<0&&void 0!==i){let t=i.get(e);void 0===t&&(t=0),i.set(e,t+1),o=9.5-Math.round(t%3.9*5),a=9.5-Math.round(Math.floor(t/4)%3.8*5),n=3,s=3,r<-1<<28&&(o+=2,n+=4,a+=2,s+=4)}else 0===r?(o=Yt,a=Yt+5,n=2*Yt,s=5):1===r?(o=-Yt,a=Yt,n=5,s=2*Yt):2===r?(o=Yt,a=-Yt,n=2*Yt,s=5):3===r?(o=Yt+5,a=Yt,n=5,s=2*Yt):(o=Math.cos(.6*r)*Yt*1.7,a=Math.sin(.6*r)*Yt*1.7,n=5,s=5,o+=n/2,a+=s/2);return{dx:o,dy:a,_:n,A:s}}function P(s){return(t,r,e)=>{var i,o,a,[r,n]=r(t.Y[0]);void 0!==r&&void 0!==n&&({dx:t,dy:i,_:o,A:a}=It(t.R[0]),e.fillStyle=s,o===a?e.fillRect(r-t-2,n-i-2,o+4,a+4):(t=r+(t<0?1:-1)*Yt,i=n+(i<0?1:-1)*Y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t,o=t+(o>Yt?1:0)*Yt*2,a=i+(a>Yt?1:0)*Yt*2,e.beginPath(),e.moveTo(r,n),e.lineTo(t,i),e.lineTo(o,a),e.lineTo(r,n),e.fill()))}}function*x(){yield new h("ISWAP",2,!0,!1,new Map([["IX","YZ"],["IZ","ZI"],["XI","ZY"],["ZI","IZ"]]),(t,r)=>t.g(r),(t,r)=>t.g(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),f(e,i,o),f(e,r,t)}),yield new h("ISWAP_DAG",2,!0,!1,new Map([["IX","YZ"],["IZ","ZI"],["XI","ZY"],["ZI","IZ"]]),(t,r)=>t.g(r),(t,r)=>t.g(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),f(e,i,o),f(e,r,t)}),yield new h("SWAP",2,!0,!1,new Map([["IX","XI"],["IZ","ZI"],["XI","IX"],["ZI","IZ"]]),(t,r)=>t.S(r),(t,r)=>t.S(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),S(e,i,o),S(e,r,t)}),yield new h("CXSWAP",2,!0,!1,new Map([["IX","XI"],["IZ","ZZ"],["XI","XX"],["ZI","IZ"]]),(t,r)=>t.k(r),(t,r)=>t.C(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),b(e,i,o),i=e,o=t,void 0!==(e=r)&&void 0!==o&&(i.fillStyle="white",i.strokeStyle="black",i.beginPath(),i.arc(e,o,Yt,0,2*Math.PI),i.f)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ill(),i.stroke(),t=.4*Yt,i.strokeStyle="black",i.lineWidth=3,i.beginPath(),i.moveTo(e-t,o-t),i.lineTo(e+t,o+t),i.stroke(),i.moveTo(e-t,o+t),i.lineTo(e+t,o-t),i.stroke(),i.lineWidth=1)}),yield new h("CZSWAP",2,!0,!1,new Map([["IX","XZ"],["IZ","ZI"],["XI","ZX"],["ZI","IZ"]]),(t,r)=>t.P(r),(t,r)=>t.P(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),b(e,i,o),b(e,r,t)})}function*L(){yield new h("CX",2,!0,!1,new Map([["IX","IX"],["IZ","ZZ"],["XI","XX"],["ZI","ZI"]]),(t,r)=>t.O(r),(t,r)=>t.O(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),s(e,i,o),a(e,r,t)}),yield new h("CY",2,!0,!1,new Map([["IX","ZX"],["IZ","ZZ"],["XI","XY"],["ZI","ZI"]]),(t,r)=>t.T(r),(t,r)=>t.T(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),s(e,i,o),n(e,r,t)}),yield new h("XCX",2,!0,!1,new Map([["IX","IX"],["IZ","XZ"],["XI","XI"],["ZI","ZX"]]),(t,r)=>t.D(r),(t,r)=>t.D(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),a(e,i,o),a(e,r,t)}),yield new h("XCY",2,!0,!1,new Map([["IX","XX"],["IZ","XZ"],[)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART("XI","XI"],["ZI","ZY"]]),(t,r)=>t.L(r),(t,r)=>t.L(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),a(e,i,o),n(e,r,t)}),yield new h("YCY",2,!0,!1,new Map([["IX","YX"],["IZ","YZ"],["XI","XY"],["ZI","ZY"]]),(t,r)=>t.U(r),(t,r)=>t.U(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),n(e,i,o),n(e,r,t)}),yield new h("CZ",2,!0,!1,new Map([["IX","ZX"],["IZ","IZ"],["XI","XZ"],["ZI","ZI"]]),(t,r)=>t.F(r),(t,r)=>t.F(r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),s(e,i,o),s(e,r,t)}),yield new h("MR",1,!0,!1,new Map([["X","ERR:I"],["Y","ERR:I"],["Z","I"]]),(t,r)=>t.G("Z",r),(t,r)=>t.G("Z",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MR",r,t)}),yield new h("MRY",1,!0,!1,new Map([["X","ERR:I"],["Y","I"],["Z","ERR:I"]]),(t,r)=>t.G("Y",r),(t,r)=>t.G("Y",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MRY",r,t)}),yield new h("MRX",1,!0,!1,new Map([["X","I"],["Y","ERR:I"],["Z","ERR:I"]]),(t,r)=>t.G("X",r),(t,r)=>t.G("X",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MRX",r,t)}),yield new h("H",1,!0,!1,new Map([["X","Z"],["Z","X"]]),(t,r)=>t.N(r),(t,r)=>t.N(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("H",r,t)}),yield new h("H_XY",1,!0,!1,new Map([["X","Y"],["Z","Z"]]),(t,r)=>t.$(r),(t,r)=>t.$(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("H",r,t-Yt/3),e.fillText("XY",r,t+Yt/3)}),yield new h("H_YZ",1,!0,!1,new Map([["X","X"],["Z","Y"]]),(t,r)=>t.K(r),(t,r)=>t.K(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("H",r,t-Yt/3),e.fillText("YZ",r,t+Yt/3)}),yield new h("POLYGON",void 0,!1,!0,void 0,()=>{},()=>{},(t,r,e)=>{var i,o=[];for(i of t.Y){var[a,n]=r(i);o.push([a-=.5,n-=.5])}C(e,o),e.globalAlpha*=t.R[3],e.fillStyle=`rgb(${255*t.R[0]},${255*t.R[1]},${255*t.R[2]})`,e.fill()}),yield new h("DETECTOR",void 0,!1,!0,void 0,()=>{},()=>{},(t,r,e)=>{}),yield new h("OBSERVABLE_INCLUDE",void 0,!1,!0,void 0,()=>{},()=>{},(t,r,e)=>{}),yield new h("MARKX",1,!0,!0,void 0,()=>{},()=>{},P("red")),yield new h("MARKY",1,!0,!0,void 0,()=>{},()=>{},P("green")),yield new h("MARKZ",1,!0,!0,void 0,()=>{},()=>{},P("blue")),yiel)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(d new h("MARK",1,!1,!0,void 0,()=>{},()=>{},(t,r,e)=>{var[r,t]=r(t.Y[0]);void 0!==r&&void 0!==t&&(e.fillStyle="magenta",e.fillRect(r-Yt,t-Yt,Yt,Yt))}),yield new h("MXX",2,!0,!1,new Map([["II","II"],["IX","IX"],["IY","ERR:IY"],["IZ","ERR:IZ"],["XI","XI"],["XX","XX"],["XY","ERR:XY"],["XZ","ERR:XZ"],["YI","ERR:YI"],["YX","ERR:YX"],["YY","YY"],["YZ","YZ"],["ZI","ERR:ZI"],["ZX","ERR:ZX"],["ZY","ZY"],["ZZ","ZZ"]]),(t,r)=>t.B("XX",r),(t,r)=>t.B("XX",r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),e.fillStyle="gray",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MXX",i,o),e.fillText("MXX",r,t)}),yield new h("MYY",2,!0,!1,new Map([["II","II"],["IX","ERR:IX"],["IY","IY"],["IZ","ERR:IZ"],["XI","ERR:XI"],["XX","XX"],["XY","ERR:XY"],["XZ","XZ"],["YI","YI"],["YX","ERR:YX"],["YY","YY"],["YZ","ERR:YZ"],["ZI","ERR:ZI"],["ZX","ZX"],[)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART("ZY","ERR:ZY"],["ZZ","ZZ"]]),(t,r)=>t.B("YY",r),(t,r)=>t.B("YY",r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),e.fillStyle="gray",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MYY",i,o),e.fillText("MYY",r,t)}),yield new h("MZZ",2,!0,!1,new Map([["II","II"],["IX","ERR:IX"],["IY","ERR:IY"],["IZ","IZ"],["XI","ERR:XI"],["XX","XX"],["XY","XY"],["XZ","ERR:XZ"],["YI","ERR:YI"],["YX","YX"],["YY","YY"],["YZ","ERR:YZ"],["ZI","ZI"],["ZX","ERR:ZX"],["ZY","ERR:ZY"],["ZZ","ZZ"]]),(t,r)=>t.B("ZZ",r),(t,r)=>t.B("ZZ",r),(t,r,e)=>{var[i,o]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,i,o,r,t),e.fillStyle="gray",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MZZ",i,o)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(),e.fillText("MZZ",r,t)}),yield new h("I",1,!0,!1,new Map([["X","X"],["Z","Z"]]),()=>{},()=>{},(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="white",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("I",r,t)}),yield new h("X",1,!0,!1,new Map([["X","X"],["Z","Z"]]),()=>{},()=>{},(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="white",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("X",r,t)}),yield new h("Y",1,!0,!1,new Map([["X","X"],["Z","Z"]]),()=>{},()=>{},(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="white",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("Y",r,t)}),yield new h("Z",1,!0,!1,new Map([["X","X"],["Z","Z"]]),()=>{},()=>{},(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="white",e)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("Z",r,t)}),yield new h("S",1,!0,!1,new Map([["X","Y"],["Z","Z"]]),(t,r)=>t.$(r),(t,r)=>t.$(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("S",r,t)}),yield new h("S_DAG",1,!0,!1,new Map([["X","Y"],["Z","Z"]]),(t,r)=>t.$(r),(t,r)=>t.$(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("S†",r,t)}),yield new h("SQRT_X",1,!0,!1,new Map([["X","X"],["Z","Y"]]),(t,r)=>t.K(r),(t,r)=>t.K(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.f)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(illStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√X",r,t)}),yield new h("SQRT_X_DAG",1,!0,!1,new Map([["X","X"],["Z","Y"]]),(t,r)=>t.K(r),(t,r)=>t.K(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√X†",r,t)}),yield new h("SQRT_Y",1,!0,!1,new Map([["X","Z"],["Z","X"]]),(t,r)=>t.N(r),(t,r)=>t.N(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√Y",r,t)}),yield new h("SQRT_Y_DAG",1,!0,!1,new Map([["X","Z"],["Z","X"]]),(t,r)=>t.N(r),(t,r)=>t.N(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="yellow",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART("√Y†",r,t)}),yield new h("R",1,!0,!1,new Map([["X","ERR:I"],["Y","ERR:I"],["Z","ERR:I"]]),(t,r)=>t.H(r),(t,r)=>t.G("Z",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("R",r,t)}),yield new h("RX",1,!0,!1,new Map([["X","ERR:I"],["Y","ERR:I"],["Z","ERR:I"]]),(t,r)=>t.H(r),(t,r)=>t.G("X",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("RX",r,t)}),yield new h("RY",1,!0,!1,new Map([["X","ERR:I"],["Y","ERR:I"],["Z","ERR:I"]]),(t,r)=>t.H(r),(t,r)=>t.G("Y",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("RY",r,t)}),yield new h)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(("M",1,!0,!1,new Map([["X","ERR:X"],["Y","ERR:Y"],["Z","Z"]]),(t,r)=>t.B("Z",r),(t,r)=>t.B("Z",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("M",r,t),e.textAlign="left"}),yield new h("MX",1,!0,!1,new Map([["X","X"],["Y","ERR:Y"],["Z","ERR:Z"]]),(t,r)=>t.B("X",r),(t,r)=>t.B("X",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MX",r,t),e.textAlign="left"}),yield new h("MY",1,!0,!1,new Map([["X","ERR:X"],["Y","Y"],["Z","ERR:Z"]]),(t,r)=>t.B("Y",r),(t,r)=>t.B("Y",r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="gray",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("MY",r,t))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,e.textAlign="left"}),yield new h("SQRT_XX",2,!0,!1,new Map([["IX","IX"],["IZ","XY"],["XI","XI"],["ZI","YX"]]),(t,r)=>t.q(r),(t,r)=>t.q(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√XX",i,o)}),yield new h("SQRT_XX_DAG",2,!0,!1,new Map([["IX","IX"],["IZ","XY"],["XI","XI"],["ZI","YX"]]),(t,r)=>t.q(r),(t,r)=>t.q(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√XX†",i,o)}),yield new h("SQRT_YY",2,!0,!1,new Map([["IX","YZ"],["IZ","YX"],["XI","ZY"],["ZI","XY"]]),(t,r)=>t.W(r),(t,r)=>t.W(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART([[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√YY",i,o)}),yield new h("SQRT_YY_DAG",2,!0,!1,new Map([["IX","YZ"],["IZ","YX"],["XI","ZY"],["ZI","XY"]]),(t,r)=>t.W(r),(t,r)=>t.W(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√YY†",i,o)}),yield new h("SQRT_ZZ",2,!0,!1,new Map([["IX","ZY"],["IZ","IZ"],["XI","YZ"],["ZI","ZI"]]),(t,r)=>t.V(r),(t,r)=>t.V(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√ZZ",i,o)}),y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ield new h("SQRT_ZZ_DAG",2,!0,!1,new Map([["IX","ZY"],["IZ","IZ"],["XI","YZ"],["ZI","ZI"]]),(t,r)=>t.V(r),(t,r)=>t.V(r),(t,r,e)=>{var i,o,[a,n]=r(t.Y[0]),[r,t]=r(t.Y[1]);c(e,a,n,r,t);for([i,o]of[[a,n],[r,t]])e.fillStyle="yellow",e.fillRect(i-Yt,o-Yt,2*Yt,2*Yt),e.strokeStyle="black",e.strokeRect(i-Yt,o-Yt,2*Yt,2*Yt),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText("√ZZ†",i,o)}),yield*x(),yield new h("C_XYZ",1,!0,!1,new Map([["X","Y"],["Z","X"]]),(t,r)=>t.j(r),(t,r)=>t.J(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="teal",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.textAlign="center",e.textBaseline="middle",e.fillText("C",r,t-Yt/3),e.fillText("XYZ",r,t+Yt/3)}),yield new h("C_ZYX",1,!0,!1,new Map([["X","Z"],["Z","Y"]]),(t,r)=>t.J(r),(t,r)=>t.j(r),(t,r,e)=>{var[r,t]=r(t.Y[0]);e.fillStyle="teal",e.fillRect(r-Yt,t-Yt,2*Yt,2*Yt),e.fillStyle="black",e.strokeStyle="black",e.strokeRect(r-Yt,t-Yt,2*Yt,2*Yt),e.textAlign="center",e)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.textBaseline="middle",e.fillText("C",r,t-Yt/3),e.fillText("ZYX",r,t+Yt/3)})}const H=function(){var t,r=new Map;for(t of L())r.set(t.name,t);return r}(),U=((t=new Map).set("CNOT",{name:"CX"}),t.set("MZ",{name:"M"}),t.set("MRZ",{name:"MR"}),t.set("RZ",{name:"R"}),t.set("H_XZ",{name:"H"}),t.set("SQRT_Z",{name:"S"}),t.set("SQRT_Z_DAG",{name:"S_DAG"}),t.set("ZCX",{name:"CX"}),t.set("ZCY",{name:"CY"}),t.set("ZCZ",{name:"CZ"}),t.set("SWAPCZ",{name:"CZSWAP"}),t.set("XCZ",{name:"CX",tt:!0}),t.set("YCX",{name:"XCY",tt:!0}),t.set("YCZ",{name:"CY",tt:!0}),t.set("SWAPCX",{name:"CXSWAP",tt:!0}),t.set("CORRELATED_ERROR",{rt:!0}),t.set("DEPOLARIZE1",{rt:!0}),t.set("DEPOLARIZE2",{rt:!0}),t.set("E",{rt:!0}),t.set("ELSE_CORRELATED_ERROR",{rt:!0}),t.set("PAULI_CHANNEL_1",{rt:!0}),t.set("PAULI_CHANNEL_2",{rt:!0}),t.set("X_ERROR",{rt:!0}),t.set("Y_ERROR",{rt:!0}),t.set("Z_ERROR",{rt:!0}),t.set("HERALDED_ERASE",{rt:!0}),t.set("HERALDED_PAULI_CHANNEL_1",{rt:!0}),t.set("MPAD",{rt:!0}),t.set("SHIFT_COORDS",{rt:!0}),t);function F(t,r))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART({var e,i=new Map;for(e of t){var o=r(e),a=i.get(o);void 0===a?i.set(o,[e]):a.push(e)}return i}class T{constructor(){this.et=new Map,this.it=[]}toString(){let t="Layer {\n";t+="    id_ops {\n";for(var[r,e]of this.et.entries())t+=`        ${r}: ${e}
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(`;t+="    }\n    markers {\n";for(var i of this.it)t+=`        ${i}
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(`;return t=t+"    }\n"+"}"}ot(){let r=F(this.nt(),t=>{let r=t.Z.name;return(r=(r=r.startsWith("MPP:")&&!H.has(r)?"MPP":r).startsWith("SPP:")&&!H.has(r)?"SPP":r).startsWith("SPP_DAG:")&&!H.has(r)&&(r="SPP_DAG"),0<t.R.length&&(r+="("+[...t.R].join(",")+")"),r});var t=[...r.keys()];return t.sort((t,r)=>{var e=t.startsWith("MARK")||t.startsWith("POLY"),i=r.startsWith("MARK")||r.startsWith("POLY");return e!==i?e<i?-1:1:t<r?-1:r<t?1:0}),new Map(t.map(t=>[t,r.get(t)]))}st(){var t=new T;return t.et=new Map(this.et),t.it=[...this.it],t}m(){let t=0;for(var[r,e]of this.et.entries())e.Y[0]===r&&(t+=e.m());return t}ht(){var t,r=["M","MX","MY","MR","MRX","MRY","MXX","MYY","MZZ","RX","RY","R"];for(t of this.et.values())if(t.Z.name.startsWith("MPP:")||-1!==r.indexOf(t.Z.name))return!0;return!1}ft(){var t,r=["M","MX","MY","MR","MRX","MRY","MXX","MYY","MZZ","RX","RY","R"];for(t of this.et.values())if(1===t.Y.length&&-1===r.indexOf(t.Z.name)&&0===t.m())return!0;return!1}lt(){var t,r=["MR","MRX","MRY","RX","RY","R"];for(t of thi)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(s.et.values())if(-1!==r.indexOf(t.Z.name))return!0;return!1}vt(){var t,r=["M","MX","MY","MR","MRX","MRY","MXX","MYY","MZZ"];for(t of this.et.values())if(t.Z.name.startsWith("MPP:")||-1!==r.indexOf(t.Z.name))return!0;return!1}empty(){return 0===this.et.size&&0===this.it.length}ct(t){var r,e,i=new T;for(r of this.et.values())t(r)&&i.put(r);for(e of this.it)t(e)&&i.it.push(e);return i}dt(r){return this.ct(t=>!t.Y.every(t=>!r(t)))}wt(e,t){var r,i,o=new Map,a=new Set;for(r of e.keys()){var n=e.get(r),s=this.et.get(r);if(void 0!==s){let r="";for(var h of s.Y){a.has(h),a.add(h);let t=e.get(h);void 0===t&&(t="I"),r+=t}var f=s.I(r),l=f.startsWith("ERR:");for(let t=0;t<s.Y.length;t++){var v=s.Y[t];l?o.set(v,"ERR:"+f[4+t]):o.set(v,f[t])}}else o.set(r,n)}for(i of this.it)if("MARKX"===i.Z.name&&i.R[0]===t){var c=i.Y[0];let t=o.get(c);void 0===t||"I"===t?t="X":"X"===t?t="I":"Y"===t?t="Z":"Z"===t&&(t="Y"),o.set(c,t)}else if("MARKY"===i.Z.name&&i.R[0]===t){c=i.Y[0];let t=o.get(c);void 0===t||"I"===t?t="Y":"X"===t?t="Z":"Y"==)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(=t?t="I":"Z"===t&&(t="X"),o.set(c,t)}else if("MARKZ"===i.Z.name&&i.R[0]===t){var d=i.Y[0];let t=o.get(d);void 0===t||"I"===t?t="Z":"X"===t?t="Y":"Y"===t?t="X":"Z"===t&&(t="I"),o.set(d,t)}return o}ut(){return 0===this.et.size&&0===this.it.length}Mt(r){if(this.it=this.it.filter(t=>-1===t.Y.indexOf(r)),this.et.has(r)){var t,e=this.et.get(r);for(t of e.Y)this.et.delete(t);return e}}Xt(r,e=void 0){this.it=this.it.filter(t=>void 0!==e&&t.R[0]!==e||"MARKX"!==t.Z.name&&"MARKY"!==t.Z.name&&"MARKZ"!==t.Z.name||t.Y[0]!==r)}put(t,r=!0){if(t.Z.i)"MARKX"!==t.Z.name&&"MARKY"!==t.Z.name&&"MARKZ"!==t.Z.name||this.Xt(t.Y[0],t.R[0]),this.it.push(t);else{for(var e of t.Y)if(this.et.has(e)){if(!r)throw new Error("Collision");this.Mt(e)}for(var i of t.Y)this.et.set(i,t)}}*nt(){for(var t of this.et.keys()){var r=this.et.get(t);r.Y[0]===t&&(yield r)}yield*this.it}}function G(t){let r=void 0,e=void 0;for(var[i,o]of t)(void 0===r||i<r||i===r&&o<e)&&(r=i,e=o);return[r,e]}function l(l){return new h("MPP:"+l,l.length,!0,!1,void 0,(t,r)=>)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t.Zt(l,r),(t,r)=>t.Zt(l,r),(r,e,i)=>{let o=void 0,a=void 0;for(let t=0;t<r.Y.length;t++){var[n,s]=e(r.Y[t]);void 0!==o&&c(i,n,s,o,a),o=n,a=s}for(let t=0;t<r.Y.length;t++){var[h,f]=e(r.Y[t]);i.fillStyle="gray",i.fillRect(h-Yt,f-Yt,2*Yt,2*Yt),i.strokeStyle="black",i.strokeRect(h-Yt,f-Yt,2*Yt,2*Yt),i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.font="bold 12pt monospace",i.fillText(l[t],h,f-1),i.font="5pt monospace",i.fillText("MPP",h,f+8)}})}const d=1e3,N=(new function(){}).toString(),z="!recursion-limit!",Q=10;function $(t,r){if(0===r)return z;if(t instanceof Map){var e,i,o=r,a=[];for([e,i]of t.entries()){if(a.length>d){a.push("[...]");break}e=D(e,o-1),i=D(i,o-1);a.push(e+": "+i)}return`Map{${a.join(", ")}}`}if(t instanceof Set){var n,s=r,h=[];for(n of t){if(h.length>d){h.push("[...]");break}h.push(D(n,s-1))}return`Set{${h.join(", ")}}`}if(void 0!==t[Symbol.iterator]){var f,l=r,v=[];for(f of t){if(v.length>d){v.push("[...]");break}v.push(D(f,l-1))}return`${t=Array.isArray(t)?"":t.constructo)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(r.name}[${v.join(", ")}]`}}function K(t,r){try{var e=String(t);if(e!==N)return e}catch{}var i=t,o=r,a=[];for(s in i)if(i.hasOwnProperty(s)){if(a.length>d){a.push("[...]");break}var n=i[s],s=D(s,o-1),n=D(n,o-1);a.push(s+": "+n)}return void 0===i.constructor?"[an unknown non-primitive value with no constructor]":(e=(e=i.constructor.name)==={}.constructor.name?"":`(Type: ${e})`)+`{${a.join(", ")}}`}function D(t,r=Q){return(null===(e=t)?"null":void 0===e?"undefined":"string"==typeof e?`"${e}"`:"number"==typeof e?""+e:void 0)||$(t,r)||K(t,r);var e}function B(t){let r=[];var e,i=()=>{""!==o&&(r.push(o),o="")};let o="";for(e of t)" "===e?i():"*"===e?(i(),r.push("*")):o+=e;return i(),r}function q(e){var t=[];let i=0;for(;i<e.length;){let r=i+1;for(;r<e.length&&"*"===e[r];)r+=2;if(r>e.length)throw Error(`Dangling combiner in ${e}.`);var o=[];for(let t=i;t<r;t+=2){if("*"===e[t]){if(0===t)throw Error(`Leading combiner in ${e}.`);throw Error(`Adjacent combiners in ${e}.`)}o.push(e[t])}t.push(o),i=r}return t}function W(t,)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(r){let e="";var i,o=[];for(i of r){if("X"!==(i="!"===i[0]?i.substring(1):i)[0]&&"Y"!==i[0]&&"Z"!==i[0])throw Error("Non-Pauli target given to MPP: "+r);e+=i[0];var a=parseInt(i.substring(1));if(a!=a)throw Error("Non-Pauli target given to MPP: "+r);o.push(a)}let n=H.get("M"+e);return void 0===(n=void 0===n?H.get("MPP:"+e):n)&&(n=l(e)),new O(n,t,new Uint32Array(o))}function V(t,r,e){let i="";var o,l,v,a=[];for(o of e){if("X"!==(o="!"===o[0]?o.substring(1):o)[0]&&"Y"!==o[0]&&"Z"!==o[0])throw Error("Non-Pauli target given to SPP: "+e);i+=o[0];var n=parseInt(o.substring(1));if(n!=n)throw Error("Non-Pauli target given to SPP: "+e);a.push(n)}let s=H.get((r?"SPP_DAG:":"SPP:")+i);return void 0===s&&(s=(l=i,v=r,new h((v?"SPP_DAG:":"SPP:")+l,l.length,!0,!1,void 0,(t,r)=>t.Rt(l,r),(t,r)=>t.Rt(l,r),(r,e,i)=>{let o=void 0,a=void 0;for(let t=0;t<r.Y.length;t++){var[n,s]=e(r.Y[t]);void 0!==o&&c(i,n,s,o,a),o=n,a=s}for(let t=0;t<r.Y.length;t++){var[h,f]=e(r.Y[t]);i.fillStyle="gray",i.fillRect(h-Yt,f-Yt,2*Yt,2*Yt),i.strokeStyle)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(="black",i.strokeRect(h-Yt,f-Yt,2*Yt,2*Yt),i.fillStyle="black",i.textAlign="center",i.textBaseline="middle",i.font="bold 12pt monospace",i.fillText(l[t],h,f-1),i.font="5pt monospace",i.fillText(v?"SPP†":"SPP",h,f+8)}}))),new O(s,t,new Uint32Array(a))}class u{constructor(t,r=[]){if(!(t instanceof Float64Array))throw new Error("!(qubitCoords instanceof Float64Array)");if(!Array.isArray(r))throw new Error("!Array.isArray(layers)");if(!r.every(t=>t instanceof T))throw new Error("!layers.every(e => e instanceof Layer)");this.Yt=t,this.yt=r}static It(t){t=t.replaceAll(";","\n").replaceAll("#!pragma MARK","MARK").replaceAll("#!pragma POLYGON","POLYGON").replaceAll("_"," ").replaceAll("Q(","QUBIT_COORDS(").replaceAll("DT","DETECTOR").replaceAll("OI","OBSERVABLE_INCLUDE").replaceAll(" COORDS","_COORDS").replaceAll(" ERROR","_ERROR").replaceAll("C XYZ","C_XYZ").replaceAll("H XY","H_XY").replaceAll("H XZ","H_XZ").replaceAll("H YZ","H_YZ").replaceAll(" INCLUDE","_INCLUDE").replaceAll("SQRT ","SQRT_").replaceAll(" DAG ",")CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(_DAG ").replaceAll("C ZYX","C_ZYX").split("\n");let g=[new T],S=0,k=new Map,C=new Set,s=(e,i,o,r)=>{g[g.length-1].empty()||g.push(new T);for(let t=0;t<r;t++){for(let r=i;r<o;r++){let t=e[r];var a,n;(t=t.split("#")[0].trim()).toLowerCase().startsWith("repeat ")?(a=parseInt(t.split(" ")[1]),n=((e,t,i)=>{let o=0;for(let r=t;r<i;r++){let t=e[r];if((t=t.split("#")[0].trim()).toLowerCase().startsWith("repeat "))o++;else if("}"===t&&0===--o)return r}throw Error("Repeat block didn't end")})(e,r,o),s(e,r+1,n,a),r=n):(o=>{let a=[],n=[],s="";if(o.indexOf(")")!==-1){let[t,r]=o.split(")");let[e,i]=t.split("(");s=e.trim();a=i.split(",").map(t=>t.trim()).map(parseFloat);n=B(r)}else{let t=o.split(" ").map(t=>t.trim()).filter(t=>t!=="");if(t.length===0)return;let[r,...e]=t;s=r.trim();a=[];n=e.flatMap(B)}let e=false;if(""!==s){0<a.length&&-1!==["M","MX","MY","MZ","MR","MRX","MRY","MRZ","MPP","MPAD"].indexOf(s)&&(a=[]);var r=U.get(s),i;if(void 0!==r){if(r.rt)return;if(void 0===r.name)throw new Error(`Unimplemented alias ${s}: $)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART({D(r)}.`);e=void 0!==r.tt&&r.tt,s=r.name}else{if("TICK"===s)return g.push(new T);if("MPP"===s){var h=q(n),f;let r=g[g.length-1];for(f of h){var l=W(new Float32Array(a),f);try{r.put(l,!1)}catch(t){g.push(new T),(r=g[g.length-1]).put(l,!1)}P.push({bt:g.length-1,_t:l.Y})}return}if("DETECTOR"===s||"OBSERVABLE_INCLUDE"===s){var v="DETECTOR"===s,c=v?S:0<a.length?Math.round(a[0]):0,d;for(d of n){if(!d.startsWith("rec[-")||!d.endsWith("]"))return console.warn("Ignoring instruction due to non-record target: "+o);var w=P.length+Number.parseInt(d.substring(4,d.length-1));if(w<0||w>=P.length)return console.warn("Ignoring instruction due to out of range record target: "+o);var u=P[w];g[u.bt].it.push(new O(H.get(s),new Float32Array([c]),new Uint32Array([u._t[0]])))}return S+=v}if("SPP"===s||"SPP_DAG"===s){var M="SPP_DAG"===s,X=q(n),Z;let r=g[g.length-1];for(Z of X)try{r.put(V(new Float32Array(a),M,Z),!1)}catch(t){g.push(new T),(r=g[g.length-1]).put(V(new Float32Array(a),M,Z),!1)}return}if(s.startsWith("QUBIT_COORDS")){var )CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(R=a.length<1?0:a[0],Y=a.length<2?0:a[1],y;for(y of n){var m=parseInt(y);k.has(m)?console.warn(`Ignoring "${o}" because there's already coordinate data for qubit ${m}.`):C.has(R+","+Y)?console.warn(`Ignoring "${o}" because there's already a qubit placed at ${R},${Y}.`):(k.set(m,[R,Y]),C.add(R+","+Y))}return}}let t=!1;for(i of n)if(i.startsWith("rec["))"CX"!==s&&"CY"!==s&&"CZ"!==s&&"ZCX"!==s&&"ZCY"!==s||(t=!0);else if("number"!=typeof parseInt(i))throw new Error(o);if(t){var I=[];for(let t=0;t<n.length;t+=2)n[t].startsWith("rec[")||n[t+1].startsWith("rec[")?console.warn("Feedback isn't supported yet. Ignoring",s,n[t],n[t+1]):(I.push(n[t]),I.push(n[t+1]));if(0===(n=I).length)return}var p=H.get(s);if(void 0===p)console.warn("Ignoring unrecognized instruction: "+o);else{var b=new Float32Array(a);let r=g[g.length-1];if(void 0===p.t)r.put(new O(p,b,new Uint32Array(n)));else{if(n.length%p.t!=0)throw new Error("Incorrect number of targets in line "+o);for(let t=0;t<n.length;t+=p.t){var _=n.slice(t,t+p.t),E=(e&&_.rever)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(se(),new Uint32Array(_)),A=new O(p,b,E);try{r.put(A,!1)}catch(t){g.push(new T),(r=g[g.length-1]).put(A,!1)}0<A.m()&&P.push({bt:g.length-1,_t:A.Y})}}}}})(t)}g[g.length-1].empty()||g.push(new T)}},P=[],o=(s(t,0,t.length,1),0<g.length&&g[g.length-1].ut()&&g.pop(),0);var r,e=t=>{let r=!0;for(;!k.has(t);){var e=r?t:o,i=e+",0";C.has(i)||(C.add(i),k.set(t,[e,0])),o+=!r,r=!1}};for(r of g)for(var i of r.nt())for(var a of i.Y)e(a);var n=Math.max(...k.keys(),0)+1,h=new Float64Array(2*n);for(let t=0;t<n;t++){e(t);var[f,l]=k.get(t);h[2*t]=f,h[2*t+1]=l}return new u(h,g)}Et(){var t,r=new Set;for(t of this.yt)for(var e of t.nt())for(var i of e.Y)r.add(i);return r}At(){return this.gt((t,r)=>[t-r,t+r])}St(){var t,r,e=new Map;for(let t=0;t<this.Yt.length;t+=2){var i=this.Yt[t],o=this.Yt[t+1];e.set(i+","+o,[i,o])}let a=1/0,n=1/0,s=256;for([t,r]of e.values())for(a=Math.min(t,a),n=Math.min(r,n);(t%s!=0||r%s!=0)&&s>1/256;)s/=2;let h;if(s<=1/256)h=1;else{h=1/s;let t=0;for(var[f,l]of e.values()){var v=(f-a+l-n)%(2*s),f=(f-a-l+n)%(2*s)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART();t=t|(0==v?1:2)|(0==f?4:8)}5===t?h/=2:10===t&&(a-=s,h/=2)}let c=-a,d=-n;return(t,r)=>[(t+c)*h,(r+d)*h]}kt(){return this.gt(this.St())}Ct(e,i){return this.gt((t,r)=>[t+e,r+i])}st(){return this.Ct(0,0)}gt(r){var e=new Float64Array(this.Yt.length);for(let t=0;t<this.Yt.length;t+=2){var[i,o]=r(this.Yt[t],this.Yt[t+1]);e[t]=i,e[t+1]=o}var t=this.yt.map(t=>t.st());return new u(e,t)}Pt(r){var e=new Map;for(let t=0;t<this.yt.length;t++){var i,o=this.yt[t];if(r)for(var a of o.ot().values())for(var n of a)0<n.m()&&(i=n.Y[0],e.set(t+":"+i,{mid:e.size,Ot:n.Y}));else for(var[s,h]of o.et.entries())h.Y[0]===s&&0<h.m()&&e.set(t+":"+s,{mid:e.size,Ot:h.Y})}var f,t=[],l=new Map;for(let r=0;r<this.yt.length;r++)for(f of this.yt[r].it)if("DETECTOR"===f.Z.name){for(var v=Math.round(f.R[0]);t.length<=v;)t.push({Tt:[],Ot:[]});var c=t[v],d=r+":"+f.Y[0],d=e.get(d);void 0!==d&&(c.Tt.push(d.mid-e.size),c.Ot.push(...d.Ot))}else if("OBSERVABLE_INCLUDE"===f.Z.name){c=Math.round(f.R[0]);let t=l.get(c);void 0===t&&(t=[],l.set(c,t));d=r+":"+)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(f.Y[0];e.has(d)&&t.push(e.get(d).mid-e.size)}var w,u,M,X=new Set,Z=[];for(w of t)0<w.Tt.length&&(w.Tt.sort((t,r)=>r-t),u=w.Tt.join(":"),X.has(u)||(X.add(u),Z.push(w)));for(M of l.values())M.sort((t,r)=>r-t);return Z.sort((t,r)=>t.Tt[0]-r.Tt[0]),{Dt:Z,xt:l}}Lt(){var t,r=new Set;for(t of this.yt)for(var D of t.nt())for(var x of D.Y)r.add(x);var{Dt:a,xt:e}=this.Pt(!0);a.reverse();let n=0;var i,s=this.m(),o=[];for(i of r){var L=this.Yt[2*i],U=this.Yt[2*i+1];o.push({Ut:i,x:L,y:U})}o.sort((t,r)=>t.x!==r.x?t.x-r.x:t.y!==r.y?t.y-r.y:t.Ut-r.Ut);var h=new Map,f=[];for(let t=0;t<o.length;t++){var{Ut:F,x:G,y:N}=o[t];h.set(F,t),f.push(`QUBIT_COORDS(${G}, ${N}) `+t)}let l=0;var v,c,d,w,u,M=new Set;for(v of this.yt){for([c,d]of v.ot().entries()){var X=[],Z=c.split("(")[0];if("DETECTOR"!==Z&&"OBSERVABLE_INCLUDE"!==Z){var R=H.get(Z);if(void 0!==R||"MPP"!==Z&&"SPP"!==Z&&"SPP_DAG"!==Z){if(void 0!==R&&R.o){var Y,y=[];for(Y of d)n+=Y.m(),y.push(...Y.Y);X.push(y)}else for(var m of d)n+=m.m(),X.push([...m.Y]);for(var z of X){var I,)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(p=[c];for(I of z)p.push(h.get(I));f.push(p.join(" "))}}else{var b,_=[Z+" "];for(b of d){n+=b.m();var Q=b.Z.name.substring(Z.length+1);for(let t=0;t<b.Y.length;t++)_.push(Q[t]+h.get(b.Y[t])),_.push("*");_.pop(),_.push(" ")}f.push(_.join("").trim())}}}let o=l;for(;0<a.length;){var E=a[a.length-1],A=s-n;if(0<=E.Tt[0]+A)break;a.pop();var g,S=[],k=[];let t=0,r=0;for(g of E.Ot){var C=this.Yt[2*g],P=this.Yt[2*g+1];t+=C,r+=P,S.push(C),k.push(P)}0<E.Ot.length&&(t/=E.Ot.length,r/=E.Ot.length,t=Math.round(2*t)/2,r=Math.round(2*r)/2),S.push(t),k.push(r);let e,i=l;for(let t=0;t>=S.length&&(t=0,i+=1),e=`DETECTOR(${S[t]}, ${k[t]}, ${i})`,M.has(e);t++);M.add(e);var O,T=[e];for(O of E.Tt)T.push(`rec[${O+A}]`);f.push(T.join(" ")),o=Math.max(o,i+1)}l=o;for([w,u]of[...e.entries()]){var $=s-n;if(!(0<=u[0]+$)){e.delete(w);var K,B=[`OBSERVABLE_INCLUDE(${w})`];for(K of u)B.push(`rec[${K+$}]`);f.push(B.join(" "))}}f.push("TICK")}for(;0<f.length&&"TICK"===f[f.length-1];)f.pop();return f.join("\n")}m(){let t=0;for(var r of this.yt)t+=r)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.m();return t}Ft(t){var r,e,i=this.Gt(),o=[];for([r,e]of t){var a=r+","+e;i.has(a)||(i.set(a,i.size),o.push(r,e))}return new u(new Float64Array([...this.Yt,...o]),this.yt.map(t=>t.st()))}Gt(){var r=new Map;for(let t=0;t<this.Yt.length;t+=2){var e=this.Yt[t],i=this.Yt[t+1];r.set(e+","+i,t/2)}return r}toString(){return this.Lt()}Nt(t){return t instanceof u&&this.Lt()===t.Lt()}}function w(t,r){if(t===r||J(t)&&J(r))return!0;var e,i=function(t,r){if(!M(t)&&void 0!==t.constructor&&t.constructor.prototype.hasOwnProperty("Nt"))return t.Nt(r);if(!M(r)&&void 0!==r.constructor&&r.constructor.prototype.hasOwnProperty("Nt"))return r.Nt(t)}(t,r);if(void 0!==i)return i;if(M(t)||M(r)||t.constructor.name!==r.constructor.name)return!1;if(t instanceof Map){var o,a,i=t,n=r;if(i.size!==n.size)return!1;for([o,a]of i){if(!n.has(o))return!1;o=n.get(o);if(!w(a,o))return!1}return!0}if(t instanceof Set)return tt(t,r);if(e=t,Array.isArray(e)||!j.every(t=>!(e instanceof t))){var s=t,h=r;if(s.length!==h.length)return!1;for(let t=0;t<s.len)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(gth;t++)if(!w(s[t],h[t]))return!1;return!0}var f,l=t,v=r;if(!tt(i=rt(l),rt(v)))return!1;for(f of i)if(f!==Symbol.iterator&&!w(l[f],v[f]))return!1;i=void 0!==l[Symbol.iterator],t=void 0!==v[Symbol.iterator];return i==t&&!(i&&t&&!function(t,r){var e=r[Symbol.iterator]();for(var i of t){var o=e.next();if(o.done||!w(i,o.value))return}return e.next().done}(l,v))}const j=[Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray];function J(t){return"number"==typeof t&&isNaN(t)}function M(t){return null==t||"string"==typeof t||"number"==typeof t||"boolean"==typeof t}function tt(t,r){if(t.size!==r.size)return!1;for(var e of t)if(!r.has(e))return!1;return!0}function rt(t){var r,e=new Set;for(r in t)t.hasOwnProperty(r)&&e.add(r);return e}class et{constructor(t,r,e,i,o,a){this.zt=t,this.Qt=r,this.altKey=e,this.shiftKey=a,this.ctrlKey=i,this.metaKey=o}Nt(t){return t instanceof et&&this.zt===t.zt&&w(this.Qt,t.Qt)&&this.altKey===t.altKey&&this.shiftKey===t.shiftKey&&thi)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(s.ctrlKey===t.ctrlKey&&this.metaKey===t.metaKey}toString(){return`ChordEvent(
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    inProgress=${this.zt},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    chord=${D(this.Qt)},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    altKey=${this.altKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    shiftKey=${this.shiftKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    ctrlKey=${this.ctrlKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(    metaKey=${this.metaKey},
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART()`}}const it=new Set(["alt","shift","control","meta"]),ot=new Set(["1","2","3","4","5","6","7","8","9","0","-","=","\\","`"]);class at{constructor(){this.$t=new Set,this.Kt=new Set,this.Bt=new Set,this.Ht=[]}qt(t){return new et(t,new Set(this.Bt),this.$t.has("alt"),this.$t.has("control"),this.$t.has("meta"),this.$t.has("shift"))}Wt(t){this.Ht.push(this.qt(t))}Vt(){this.Kt.clear(),this.Bt.clear(),this.$t.clear()}jt(t){var r,e,i=t.key.toLowerCase();if("escape"===i&&this.Vt(),"keydown"===t.type){for([r,e]of[[t.altKey,"alt"],[t.shiftKey,"shift"],[t.ctrlKey,"control"],[t.metaKey,"meta"]])r?this.$t.add(e):this.$t.delete(e);it.has(i)||(this.Kt.add(i),this.Bt.add(i)),this.Wt(!0)}else{if("keyup"!==t.type)throw new Error("Not a recognized key event type: "+t.type);it.has(i)||(this.Kt.delete(i),this.Wt(0<this.Kt.size&&!ot.has(i)),ot.has(i)&&this.Bt.delete(i),0===this.Kt.size&&(this.$t.clear(),this.Bt.clear()))}}}class nt{constructor(t,r,e=0,i=!1){this.action=t,this.Jt=r,this.tr=e,this.rr=i,this.er="idle",this.ir=-1/0}ar)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART((){var t=this.Jt-(performance.now()-this.ir);if(0<t)this.nr(t);else{this.er="running";t=performance.now();try{this.action()}finally{t=performance.now()-t;this.ir=performance.now()+t*this.tr,"running-and-triggered"===this.er?this.nr(this.Jt):this.er="idle"}}}sr(){switch(this.er){case"idle":this.ar();break;case"waiting":break;case"running":this.er="running-and-triggered";break;case"running-and-triggered":break;default:throw new Error("Unrecognized throttle state: "+this.er)}}nr(e){if(this.er="waiting",this.rr){let t,r=performance.now();(t=()=>{performance.now()<r+e?requestAnimationFrame(t):(this.er="idle",this.ir=-1/0,this.sr())})()}else setTimeout(()=>{this.er="idle",this.ir=-1/0,this.sr()},e)}}class i{constructor(t){this.hr=t}subscribe(t){return this.hr(t)}static of(...e){return new i(t=>{for(var r of e)t(r);return()=>{}})}lr(){let r=[];return this.subscribe(t=>r.push(t))(),r}map(e){return new i(r=>this.subscribe(t=>r(e(t))))}filter(e){return new i(r=>this.subscribe(t=>{e(t)&&r(t)}))}vr(s,h){return new i(r=>{)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(let e=!1,i=!1,o,a,t=this.subscribe(t=>{o=t,e=!0,i&&r(h(o,a))}),n=s.subscribe(t=>{a=t,i=!0,e&&r(h(o,a))});return()=>{t(),n()}})}static cr(){return new i(t=>{let r,e=!1;return(r=()=>{e||(t(void 0),window.requestAnimationFrame(r))})(),()=>{e=!0}})}dr(){return new i(e=>{let i=()=>{},o=!1,t=this.subscribe(t=>{var r;o||(r=i,i=t.subscribe(e),r())});return()=>{o=!0,i(),t()}})}wr(r){return this.map(t=>(r(t),t))}ur(){return new i(r=>{let e=[];return e.push(this.subscribe(t=>e.push(t.subscribe(r)))),()=>{for(var t of e)t()}})}Mr(a){return new i(t=>{let r=void 0,e=!1,i=new nt(()=>{e||t(r)},a),o=this.subscribe(t=>{r=t,i.sr()});return()=>{e=!0,o()}})}static Xr(r,e){return new i(t=>(r.addEventListener(e,t),()=>r.removeEventListener(e,t)))}Zr(t){return new i(r=>{let e=t;return this.subscribe(t=>{0<e?--e:r(t)})})}Rr(t=void 0){let o=t||((t,r)=>t===r);return new i(r=>{let e=!1,i=void 0;return this.subscribe(t=>{e&&o(i,t)||(i=t,e=!0,r(t))})})}}class st{constructor(){this.Yr=[],this.yr=new i(t=>{this.Yr.push(t);let r=!1;return()=)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(>{r||(r=!0,this.Yr.splice(this.Yr.indexOf(t),1))}})}mr(){return this.yr}send(t){for(var r of this.Yr)r(t)}}class ht{constructor(t=void 0){this.Ir=t,this.pr=new st,this.yr=new i(t=>(t(this.Ir),this.pr.mr().subscribe(t)))}mr(){return this.yr}set(t){this.Ir=t,this.pr.send(t)}get(){return this.Ir}}class ft{constructor(t,r,e){if(r<0||r>=t.length)throw new Error("Bad index: "+{history:t,index:r,br:e});if(!Array.isArray(t))throw new Error("Bad history: "+{history:t,index:r,br:e});this.history=t,this.index=r,this.br=e,this._r=new st,this.Er=new ht(this.history[this.index])}Ar(){return this._r.mr()}gr(){return this.Er.mr()}Sr(){return this.Er.get()}static kr(t){return new ft([t],0,!1)}Cr(){return 0===this.index&&!this.br}Pr(){return this.index===this.history.length-1}clear(t){this.history=[t],this.index=0,this.br=!1,this.Er.set(t),this._r.send(t)}Or(t){this.br=t!==this.history[this.index],this._r.send(void 0)}Tr(){this.br=!1;var t=this.history[this.index];return this.Er.set(t),this._r.send(t),t}commit(t){t===this.hist)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ory[this.index]?this.Tr():(this.br=!1,this.index+=1,this.history.splice(this.index,this.history.length-this.index),this.history.push(t),this.Er.set(t),this._r.send(t))}Dr(){if(!this.br){if(0===this.index)return;--this.index}this.br=!1;var t=this.history[this.index];return this.Er.set(t),this._r.send(t),t}Lr(){var t;if(this.index+1!==this.history.length)return this.index+=1,this.br=!1,t=this.history[this.index],this.Er.set(t),this._r.send(t),t}toString(){return"Revision("+D({index:this.index,count:this.history.length,Ur:this.br,head:this.history[this.index]})+")"}Nt(t){return t instanceof ft&&this.index===t.index&&this.br===t.br&&w(this.history,t.history)}}let pt=32;function lt(t,e,D,o,x){var L,r=Math.floor(t.canvas.width/2),i=e.Fr();i.sort((t,r)=>{var[t,e]=o(t),[r,i]=o(r);return e!==i?e-i:t-r});let a=new Map,U=void 0,n=0,s=0,h=0,f=0;for(L of i){var[F,l]=o(L);s+=pt,U!==l?(U=l,n=1.5*r,h=Math.max(h,f),f=0,s+=.25*pt):(n+=.25*Yt,f++),a.set(F+","+l,[Math.round(n)+.5,Math.round(s)+.5])}let v=pt+Math.ceil(Yt*h*.25);v)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ar c=Math.floor(t.canvas.width/4/v);let G=e.Gr-c+1,d=Math.max(0,Math.min(G,x-2*c+1));var w=Math.min(d+2*c+2,x);let N=t=>{t-=e.Gr;return(t-=d-G)*v},u=(t,r)=>{var[t,e]=o(t);return[t,e,r]=[[t,e,r]][0],t=t+","+e,a.has(t)?([e,t]=a.get(t),[e+N(r),t]):[void 0,void 0]};t.save();try{t.clearRect(r,0,r,t.canvas.height);var z,Q,$=new Map;for([z,Q]of D.entries()){E=_=b=et=rt=tt=J=p=P=C=j=V=W=k=I=m=q=S=g=H=A=y=Y=B=K=R=Z=X=M=void 0;var M=t,X=u,Z=Q,R=z,K=d,B=w,Y=v,y=$;for(let o=K-1;o<=B;o++){y.has(o)||y.set(o,new Map);var m,I,p,b,_,E,A=y.get(o),H=Z.Nr(o+.5),g=Z.Nr(o);for([m,I]of H.zr.entries()){let{dx:t,dy:r,_:e,A:i}=It(R,m,A);0<=R&&R<4?(t=0,e=Y,i=5,0===R?r=10:1===R?r=5:2===R?r=0:3===R&&(r=-5)):t-=Y/2;var[S,q]=X(m,o);if(void 0!==S&&void 0!==q){if("X"===I)M.fillStyle="red";else if("Y"===I)M.fillStyle="green";else{if("Z"!==I)throw new Error("Not a pauli: "+I);M.fillStyle="blue"}M.fillRect(S-t,q-r,e,i)}}for(p of g.Qr){var{dx:k,dy:W,_:V,A:j}=It(R,p,A),[C,P]=(k-=Y/2,X(p,o-.5));void 0!==C&&void 0!==P&&(M.strokeStyle="magenta",M.li)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(neWidth=8,M.strokeRect(C-k,P-W,V,j),M.lineWidth=1,M.fillStyle="black",M.fillRect(C-k,P-W,V,j))}for({$r:b,Kr:_,color:E}of g.Br){var[J,tt]=X(b,o),[rt,et]=X(_,o);"X"===E?M.strokeStyle="red":"Y"===E?M.strokeStyle="green":"Z"===E?M.strokeStyle="blue":M.strokeStyle="magenta",M.lineWidth=8,mt(M,J,tt,rt,et),M.lineWidth=1}}}t.globalAlpha*=.5,t.fillStyle="black";var it,O,ot,at=N(e.Gr)+1.5*r-v/2;t.fillRect(at,0,v,t.canvas.height),t.globalAlpha*=2,t.strokeStyle="black",t.fillStyle="black";for(it of i){var[nt,st]=u(it,d-1),[ht,ft]=u(it,w+1);t.beginPath(),t.moveTo(nt,st),t.lineTo(ht,ft),t.stroke()}t.textAlign="right",t.textBaseline="middle";for(O of i){var[lt,vt]=u(O,d-1),ct=e.Hr.Yt[2*O],dt=e.Hr.Yt[2*O+1];t.fillText(ct+`,${dt}:`,lt,vt)}for(let r=d;r<=w;r++){var wt=t=>u(t,r),ut=e.Hr.yt[r];if(void 0!==ut)for(var Mt of ut.nt())Mt.p(wt,t)}t.globalAlpha=.5;for(ot of i){var[Xt,T]=u(ot,d-1),[Zt,Rt]=o(ot);e.qr>t.canvas.width/2&&e.Wr>=T+yt-.55*pt&&e.Wr<=T+.55*pt+yt&&(t.beginPath(),t.moveTo(Xt,T),t.lineTo(Zt,Rt),t.stroke(),t.fillSty)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(le="black",t.fillRect(Zt-20,Rt-20,40,40),t.fillRect(t.canvas.width/2,T-pt/3,t.canvas.width/2,2*pt/3))}}finally{t.restore()}}class X{constructor(t,r){if(32<t)throw new Error("num_frames > 32");this.t=r,this.Vr=t,this.jr=new Uint32Array(r),this.Jr=new Uint32Array(r),this.flags=new Uint32Array(r)}st(){var r=new X(this.Vr,this.t);for(let t=0;t<this.t;t++)r.jr[t]=this.jr[t],r.Jr[t]=this.Jr[t],r.flags[t]=this.flags[t];return r}te(n){if(n.length!==this.t)throw new Error("qubit_keys.length !== this.num_qubits");var s=[];for(let t=0;t<this.Vr;t++)s.push(new Map);for(let a=0;a<this.t;a++){var h=n[a];let t=this.jr[a],r=this.Jr[a],e=this.flags[a],i=t|r|e,o=0;for(;i;)1&i&&(1&e?s[o].set(h,"ERR:flag"):t&r&1?s[o].set(h,"Y"):1&t?s[o].set(h,"X"):s[o].set(h,"Z")),o++,t>>=1,r>>=1,e>>=1,i>>=1}return s}static re(e){var t=e.length;if(0===t)throw new Error("strings.length === 0");var r,i=e[0].length;for(r of e)if(r.length!==i)throw new Error("Inconsistent string length.");var o=new X(t,i);for(let r=0;r<t;r++)for(let t=0;t<i;t++){var)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART( a=e[r][t];if("X"===a)o.jr[t]|=1<<r;else if("Y"===a)o.jr[t]|=1<<r,o.Jr[t]|=1<<r;else if("Z"===a)o.Jr[t]|=1<<r;else if("I"!==a&&"_"!==a)if("!"===a)o.flags[t]|=1<<r;else if("%"===a)o.flags[t]|=1<<r,o.jr[t]|=1<<r;else{if("&"===a)o.flags[t]|=1<<r,o.jr[t]|=1<<r;else{if("$"!==a)throw new Error("Unrecognized pauli string character: '"+a+"'");o.flags[t]|=1<<r}o.Jr[t]|=1<<r}}return o}ee(){var t=[];for(let e=0;e<this.Vr;e++){let r="";for(let t=0;t<this.t;t++){var i=this.flags[t]>>e&1,o=this.jr[t]>>e&1,a=this.Jr[t]>>e&1;r+="_XZY!%$&"[o+2*a+4*i]}t.push(r)}return t}static ie(e,i){var o=new X(e.length,i.length);for(let r=0;r<e.length;r++)for(let t=0;t<i.length;t++){var a=e[r].get(i[t]);"X"===a?o.jr[t]|=1<<r:"Z"===a?o.Jr[t]|=1<<r:"Y"===a?(o.jr[t]|=1<<r,o.Jr[t]|=1<<r):"I"!==a&&void 0!==a&&(o.flags[t]|=1<<r)}return o}N(t){for(var r of t){var e=this.jr[r],i=this.Jr[r];this.Jr[r]=e,this.jr[r]=i}}$(t){for(var r of t)this.Jr[r]^=this.jr[r]}K(t){for(var r of t)this.jr[r]^=this.Jr[r]}H(t){for(var r of t)this.flags[r]|=this.jr[r],th)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(is.flags[r]|=this.Jr[r],this.jr[r]=0,this.Jr[r]=0}B(i,o){for(let e=0;e<o.length;e+=i.length){let r=0;for(let t=0;t<i.length;t++){var a=o[e+t],n=i[t];if("X"===n)r^=this.Jr[a];else if("Z"===n)r^=this.jr[a];else{if("Y"!==n)throw new Error(`Unrecognized measure obs: '${n}'`);r^=this.jr[a]^this.Jr[a]}}for(let t=0;t<i.length;t++){var s=o[e+t];this.flags[s]|=r}}}Zt(r,e){if(r.length!==e.length)throw new Error("bases.length !== targets.length");let i=0;for(let t=0;t<r.length;t++){var o=e[t],a=r[t];if("X"===a)i^=this.Jr[o];else if("Z"===a)i^=this.jr[o];else{if("Y"!==a)throw new Error(`Unrecognized measure obs: '${a}'`);i^=this.jr[o]^this.Jr[o]}}for(let t=0;t<r.length;t++){var n=e[t];this.flags[n]|=i}}Rt(i,o){if(i.length!==o.length)throw new Error("bases.length !== targets.length");let a=0;for(let t=0;t<i.length;t++){var r=o[t],e=i[t];if("X"===e)a^=this.Jr[r];else if("Z"===e)a^=this.jr[r];else{if("Y"!==e)throw new Error(`Unrecognized spp obs: '${e}'`);a^=this.jr[r]^this.Jr[r]}}for(let e=0;e<i.length;e++){var n=o[e],s=i[)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(e];let t=0,r=0;if("X"===s)t=1;else{if("Z"!==s){if("Y"!==s)throw new Error(`Unrecognized spp obs: '${s}'`);t=1}r=1}t&&(this.jr[n]^=a),r&&(this.Jr[n]^=a)}}G(t,r){if("X"===t)for(var e of r)this.flags[e]|=this.Jr[e],this.jr[e]=0,this.Jr[e]=0;else if("Z"===t)for(var i of r)this.flags[i]|=this.jr[i],this.jr[i]=0,this.Jr[i]=0;else{if("Y"!==t)throw new Error("Unrecognized demolition obs");for(var o of r)this.flags[o]|=this.jr[o]^this.Jr[o],this.jr[o]=0,this.Jr[o]=0}}j(t){for(var r of t)this.jr[r]^=this.Jr[r],this.Jr[r]^=this.jr[r]}J(t){for(var r of t)this.Jr[r]^=this.jr[r],this.jr[r]^=this.Jr[r]}S(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i];this.jr[e]=n,this.Jr[e]=s,this.jr[i]=o,this.Jr[i]=a}}g(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i],h=o^n;this.jr[e]=n,this.Jr[e]=s^h,this.jr[i]=o,this.Jr[i]=a^h}}q(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.Jr[e]^this.Jr[i];this.jr[e]^=o,this.jr[i)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(]^=o}}W(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i];a^=o,o^=s^=n,s^=n^=a,a^=o,this.jr[e]=a,this.Jr[e]=o,this.jr[i]=s,this.Jr[i]=n}}V(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e]^this.jr[i];this.Jr[e]^=o,this.Jr[i]^=o}}D(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1];this.jr[i]^=this.Jr[e],this.jr[e]^=this.Jr[i]}}L(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1];this.jr[i]^=this.Jr[e],this.Jr[i]^=this.Jr[e],this.jr[e]^=this.jr[i],this.jr[e]^=this.Jr[i]}}U(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e]^this.Jr[e];this.jr[i]^=o,this.Jr[i]^=o,o=this.jr[i]^this.Jr[i],this.jr[e]^=o,this.Jr[e]^=o}}O(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1];this.jr[i]^=this.jr[e],this.Jr[e]^=this.Jr[i]}}k(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i];this.jr[e]=n^o,this.Jr[e]=s,this.jr[i]=o,this.Jr[i]=a^s}}C(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i];this.jr[e]=n,this.Jr[e]=a^s,this.jr[i]=n^o,this.Jr[i]=a}}P(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1],o=this.jr[e],a=this.Jr[e],n=this.jr[i],s=this.Jr[i];this.jr[e]=n,this.Jr[e]=s^o,this.jr[i]=o,this.Jr[i]=a^n}}T(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1];this.jr[i]^=this.jr[e],this.Jr[i]^=this.jr[e],this.Jr[e]^=this.Jr[i],this.Jr[e]^=this.jr[i]}}F(r){for(let t=0;t<r.length;t+=2){var e=r[t],i=r[t+1];this.Jr[i]^=this.jr[e],this.Jr[e]^=this.jr[i]}}oe(t,r){t.l(this,r)}ae(t,r){t.v(this,r)}Nt(r){if(!(r instanceof X)||r.Vr!==this.Vr||r.t!==this.t)return!1;for(let t=0;t<this.t;t++)if(this.jr[t]!==r.jr[t]||this.Jr[t]!==r.Jr[t]||this.flags[t]!==r.flags[t])return!1;return!0}toString(){return this.ee().join("\n")}}class Z{constructor(t,r,e){this.zr=t,this.Qr=r,this.Br=e}ne(t){for(var r of this.zr.keys())if(t.has(r))return!0;for(var e of this.Qr.keys())if(t.has(e))return!0;return!1}se(t){return new Z(new Map([...this.zr.entries(),...t.zr.entries()]),new)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART( Set([...this.Qr,...t.Qr]),[...this.Br,...t.Br])}toString(){let t=0;for(var r of this.zr.keys())t=Math.max(t,r+1);for(var e of this.Qr)t=Math.max(t,e+1);for(var[i,o]of this.Br)t=Math.max(t,i+1),t=Math.max(t,o+1);let a='"';for(let r=0;r<t;r++){let t=this.zr.get(r);void 0===t&&(t="_"),this.Qr.has(r)&&(t="E"),a+=t}return a+='"'}}class E{constructor(t){this.he=t}Nt(t){return t instanceof E&&w(this.he,t.he)}toString(){var t,r=[...this.he.keys()],e=(r.sort((t,r)=>t-r),["PropagatedPauliFrames {"]);for(t of r)e.push(`    ${t}: `+this.he.get(t));return e.push("}"),e.join("\n")}Nr(t){let r=this.he.get(t);return r=void 0===r?new Z(new Map,new Set,[]):r}static fe(r,e){var i=new E(new Map);let o=new Map;for(let t=0;t<r.yt.length;t++){var a,n=r.yt[t],s=o,h=(o=n.wt(o,e),new Set);for(a of[...o.keys()]){var f=o.get(a);f.startsWith("ERR:")&&(h.add(a),o.set(a,f.substring(4))),"I"===o.get(a)&&o.delete(a)}var l,v=[];for(l of n.nt())if(2===l.Z.t&&!l.Z.i){var c,[d,w]=l.Y,u=new Set;for(c of l.Y){var M=o.get(c),X=s.get(c);M!==X&&(voi)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(d 0!==M&&u.add(M),void 0!==X)&&u.add(X)}if(0<u.size){let t="I";1===u.size&&(t=[...u][0]),v.push({$r:d,Kr:w,color:t})}}0<o.size&&i.he.set(t+.5,new Z(o,new Set,[])),(0<h.size||0<v.length)&&i.he.set(t,new Z(new Map,h,v))}return i}static le(r,e){var i=new E(new Map),o=new X(1,r.Et().size);let a=0;for(let t=r.yt.length-1;-1<=t;t--){var n,s=0<=t?r.yt[t]:new T,h=[...s.et.keys()];h.reverse();for(n of h){var f=s.et.get(n);if(f.Y[0]===n){var l=f.m();if(o.ae(f.Z,[...f.Y]),a-=l,0<l&&-1!==e.indexOf(a))for(let r=0;r<f.Y.length;r++){var v=f.Y[r];let t;if("MX"===f.Z.name||"MRX"===f.Z.name||"MXX"===f.Z.name)t="X";else if("MY"===f.Z.name||"MRY"===f.Z.name||"MYY"===f.Z.name)t="Y";else if("M"===f.Z.name||"MR"===f.Z.name||"MZZ"===f.Z.name)t="Z";else{if("MPAD"===f.Z.name)continue;if(!f.Z.name.startsWith("MPP:"))throw new Error("Unhandled measurement gate: "+f.Z.name);t=f.Z.name[r+4]}if("X"===t)o.jr[v]^=1;else{if("Y"===t)o.jr[v]^=1;else if("Z"!==t)throw new Error("Unhandled measurement gate: "+f.Z.name);o.Jr[v]^=1}}}}var c=new Map,)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(d=new Set;for(let t=0;t<o.jr.length;t++)(o.jr[t]||o.Jr[t])&&c.set(t,"_XZY"[o.jr[t]+2*o.Jr[t]]),o.flags[t]&&(o.flags[t]=0,d.add(t));0<c.size&&i.he.set(t-.5,new Z(c,new Set,[])),0<d.size&&i.he.set(t,new Z(new Map,d,[]))}return i}}function vt(t,r){var e,i,o,a;return void 0!==t&&void 0!==r&&(e=t/_,i=r/_,e=Math.floor(2*e+.5)/2,i=Math.floor(2*i+.5)/2,o=e*_,a=i*_,Math.abs(o-t)<=Yt)&&Math.abs(a-r)<=Yt&&e%1==i%1?[e,i]:[void 0,void 0]}function ct(t,r,e,i){var o,a,n=new Map;for([o,a]of i.entries()){_=k=S=g=A=E=v=l=f=b=p=I=m=y=Y=h=s=R=Z=X=M=u=w=d=c=void 0;var s,h,f,l,v,c=t,d=r,w=e,u=a,M=o,X=n,Z=u.Nr(d.Gr+.5).zr,R=[];for([s,h]of Z.entries())R.push([h,w(s)]);if(0<=M&&0<R.length){R.every(t=>"X"===t[0])?c.fillStyle="red":R.every(t=>"Y"===t[0])?c.fillStyle="green":R.every(t=>"Z"===t[0])?c.fillStyle="blue":c.fillStyle="black",c.strokeStyle=c.fillStyle;var Y,y,Z=R.map(t=>t[1]);let n=0,s=0;for([Y,y]of Z)n+=Y,s+=y;n/=Z.length,s/=Z.length,Z.sort((t,r)=>{var[t,e]=t,[r,i]=r;let o=Math.atan2(e-s,t-n),a=Math.atan2(i-s,r-n);return t===)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(n&&e===s&&(o=-100),r===n&&i===s&&(a=-100),o-a}),C(c,Z),c.globalAlpha*=.25,c.fill(),c.globalAlpha*=4,1<Z.length&&(c.lineWidth=2,c.stroke(),c.lineWidth=1)}for([f,[l,v]]of R){var{dx:m,dy:I,_:p,A:b}=It(M,l+":"+v,X);if("X"===f)c.fillStyle="red";else if("Y"===f)c.fillStyle="green";else{if("Z"!==f)throw new Error("Not a pauli: "+f);c.fillStyle="blue"}c.fillRect(l-m,v-I,p,b)}for(_ of Z=u.Nr(d.Gr).Qr){var[_,E]=w(_),{dx:A,dy:g,_:S,A:k}=It(M,_+":"+E,X);c.lineWidth=M<0?2:8,c.strokeStyle="magenta",c.strokeRect(_-A,E-g,S,k),c.lineWidth=1,c.fillStyle="black",c.fillRect(_-A,E-g,S,k)}}}let dt=!0;function A(t,r){t.save();try{dt&&r()}finally{t.restore()}}function wt(Z,R){let Y=R.Hr,r=0;for(var t of Y.yt)for(var e of t.it){var i=e.Z;"MARKX"!==i.name&&"MARKY"!==i.name&&"MARKZ"!==i.name||(r=Math.max(r,e.R[0]+1))}let y=(t,r)=>[t*_-g,r*_-yt],m=t=>{var r=Y.Yt[2*t],t=Y.Yt[2*t+1];return y(r,t)},I=new Map;for(let t=0;t<r;t++)I.set(t,E.fe(Y,t));var o,a,{Dt:n,xt:s}=Y.Pt(!1);for(let t=0;t<n.length;t++)I.set(~t,E.le(Y,n[t].Tt));for(o of s.k)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(eys())I.set(~o^1<<30,E.le(Y,s.get(o)));let p=new Set;for(a of Y.Et()){var h=Y.Yt[2*a],f=Y.Yt[2*a+1];p.add(h+","+f)}A(Z,()=>{Z.fillStyle="white",Z.clearRect(0,0,Z.canvas.width,Z.canvas.height);var[t,r]=vt(R.qr,R.Wr);let e=R.Gr;for(let t=0;t<=R.Gr;t++)for(var i of Y.yt[t].it)if("POLYGON"===i.Z.name){e=t;break}var o,a,n,s,h=[...Y.yt[e].it];h.sort((t,r)=>r.Y.length-t.Y.length);for(o of h)"POLYGON"===o.Z.name&&o.p(m,Z);A(Z,()=>{for(let t=0;t<100;t+=.5){var[r,,]=y(t,0),e=""+t;Z.fillStyle="black",Z.fillText(e,r-Z.measureText(e).width/2,15)}for(let t=0;t<100;t+=.5){var[,i]=y(0,t),o=""+t;Z.fillStyle="black",Z.fillText(o,18-Z.measureText(o).width,i)}Z.strokeStyle="black";for(let r=0;r<100;r+=.5){var[t,,]=y(r,0),a=""+r;Z.fillStyle="black",Z.fillText(a,t-Z.measureText(a).width/2,15);for(let t=r%1;t<100;t+=1){var[n,s]=y(r,t),h=(r,Z.fillStyle="white",!p.has(r+","+t));h&&(Z.globalAlpha*=.25,Z.globalAlpha*=.25),Z.fillRect(n-Yt,s-Yt,2*Yt,2*Yt),Z.strokeRect(n-Yt,s-Yt,2*Yt,2*Yt),h&&(Z.globalAlpha*=4,Z.globalAlpha*=4)}}});for([a)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,n]of I.entries()){u=w=d=X=M=c=v=l=f=void 0;var f=Z,l=R,v=m,c=n;if(a,void 0!==(c=c.Nr(l.Gr).Br))for(var{$r:d,Kr:w,color:u}of c){var[d,M]=v(d),[w,X]=v(w);"X"===u?f.strokeStyle="red":"Y"===u?f.strokeStyle="green":"Z"===u?f.strokeStyle="blue":f.strokeStyle="magenta",f.lineWidth=8,mt(f,d,M,w,X),f.lineWidth=1}}for(s of Y.yt[R.Gr].nt())"POLYGON"!==s.Z.name&&s.p(m,Z);A(Z,()=>{Z.globalAlpha*=.25;for(var[t,r]of R.ve.values()){var[t,r]=y(t,r);Z.fillStyle="yellow",Z.fillRect(t-1.25*Yt,r-1.25*Yt,2.5*Yt,2.5*Yt)}}),A(Z,()=>{Z.globalAlpha*=.5;for(var[t,r]of R.ce.values()){var[t,r]=y(t,r);Z.fillStyle="blue",Z.fillRect(t-1.25*Yt,r-1.25*Yt,2.5*Yt,2.5*Yt)}}),ct(Z,R,m,I),void 0!==t&&(Z.save(),Z.globalAlpha*=.5,[h,t]=y(t,r),Z.fillStyle="red",Z.fillRect(h-Yt,t-Yt,2*Yt,2*Yt),Z.restore()),A(Z,()=>{var t,r,e,i,o,a;Z.globalAlpha*=.25,Z.fillStyle="blue",void 0!==R.de&&void 0!==R.qr&&(t=Math.min(R.qr,R.de),r=Math.max(R.qr,R.de),e=Math.min(R.Wr,R.we),i=Math.max(R.Wr,R.we),--t,r+=1,--e,i+=1,t-=g,r-=g,e-=yt,i-=yt,Z.fillRect(t,e,r-t,i-e));f)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(or([o,a]of R.ue){var[n,s]=y(o,a);Z.fillRect(n-Yt,s-Yt,2*Yt,2*Yt)}})}),lt(Z,R,I,m,Y.yt.length),Z.save();try{Z.strokeStyle="black",Z.translate(Math.floor(Z.canvas.width/2),0);for(let n=0;n<Y.yt.length;n++){let t=!1,r=!1,e=!1,i=!1;var l=Y.yt[n].lt(),v=Y.yt[n].vt();let o=!1,a=!1;var c,d,w=Y.yt[n].ft();for(c of Y.yt[n].it)t|="POLYGON"===c.Z.name,r|="MARKX"===c.Z.name,e|="MARKY"===c.Z.name,i|="MARKZ"===c.Z.name;for(d of Y.yt[n].et.values())o|=2===d.Y.length,a|=2<d.Y.length;if(Z.fillStyle="white",Z.fillRect(8*n,0,8,20),w?(Z.fillStyle="#FF0",Z.fillRect(8*n,0,8,20)):t&&(Z.fillStyle="#FBB",Z.fillRect(8*n,0,8,7),Z.fillStyle="#BFB",Z.fillRect(8*n,7,8,7),Z.fillStyle="#BBF",Z.fillRect(8*n,14,8,6)),v?(Z.fillStyle="#DDD",Z.fillRect(8*n,0,8,20)):l&&(Z.fillStyle="#DDD",Z.fillRect(8*n,0,4,20)),r&&(Z.fillStyle="red",Z.fillRect(8*n+3,14,3,3)),e&&(Z.fillStyle="green",Z.fillRect(8*n+3,9,3,3)),i&&(Z.fillStyle="blue",Z.fillRect(8*n+3,3,3,3)),a){Z.strokeStyle="black",Z.beginPath();var u,M=8*n+.5;for(u of[3,5])Z.moveTo(M+u,6),Z.lineTo()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(M+u,15);Z.stroke()}o&&(Z.strokeStyle="black",Z.beginPath(),Z.moveTo(8*n+.5+4,6),Z.lineTo(8*n+.5+4,15),Z.stroke())}Z.fillStyle="black",Z.beginPath(),Z.moveTo(8*R.Gr+.5+4,16),Z.lineTo(8*R.Gr+.5-2,28),Z.lineTo(8*R.Gr+.5+10,28),Z.closePath(),Z.fill();for(let r=0;r<Y.yt.length;r++){var X=![...I.values()].every(t=>0===t.Nr(r).Qr.size),b=0<Y.yt[r].et.size||0<Y.yt[r].it.length;X?(Z.strokeStyle="magenta",Z.lineWidth=4,Z.strokeRect(8*r+.5-1,-.5,9,22),Z.lineWidth=1):(Z.strokeStyle=b?"#000":"#EEE",Z.strokeRect(8*r+.5,.5,8,20))}}finally{Z.restore()}}class ut{constructor(t,r,e,i,o,a,n,s,h){for(this.Hr=t.st(),this.Gr=r,this.ce=new Map(e.entries()),this.ve=new Map(i.entries()),this.qr=o,this.Wr=a,this.de=n,this.we=s,this.ue=[...h];this.Hr.yt.length<=this.Gr;)this.Hr.yt.push(new T)}Me(){return this.Hr.Et()}Fr(){let r=this.Me();var t=[];if(0<this.ve.size){var e,i=this.Hr.Gt();for(e of this.ve.keys()){var o=i.get(e);void 0!==o&&t.push(o)}}else t.push(...r.values());return t.filter(t=>r.has(t))}}function Mt(r){let e=[1,0],i=[0,1)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(];var o=(t,r)=>[t-r,t+r];r=(r%8+8)%8;for(let t=0;t<r;t++)e=o(e[0],e[1]),i=o(i[0],i[1]);return(t,r)=>[e[0]*t+i[0]*r,e[1]*t+i[1]*r]}function Xt(){try{return window.self===window.top}catch(t){}}class Zt{constructor(){this.Xe=!1,this.Ze=void 0}Re(){this.Ze={Ye:!0}}ye(t){this.Ze=t}me(){this.Ze=void 0}Ie(t,r){if(!r.startsWith("#"))throw new Error('"Expected a hash URL: '+{pe:t,be:r});if(Xt()&&this.Ze!==t)if(this.Xe)document.location.hash=r;else try{void 0===this.Ze?history.replaceState(t,"",r):(history.pushState(t,"",r),this.Ze=void 0)}catch(t){console.warn("Calling 'history.replaceState/pushState' failed. Falling back to setting location.hash.",t),this.Xe=!0,document.location.hash=r}}}function Rt(t){return"#circuit="+(t=-1===(t=t.replaceAll("QUBIT_COORDS","Q").replaceAll("DETECTOR","DT").replaceAll("OBSERVABLE_INCLUDE","OI").replaceAll(", ",",").replaceAll(") ",")").replaceAll(" ","_").replaceAll("\n",";")).indexOf("%")&&-1===t.indexOf("&")?t:encodeURIComponent(t))}let r=document.getElementById("toolbox"),R=10.5,Y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(=["H","S","R","M","MR","C","W","SC","MC","P","1-9"],bt=[1,2,2,2,2,1,2,2,2,-1,-1,-1];let _t=function(){var r=new Map([["0,0",H.get("H_YZ")],["0,1",H.get("H")],["0,2",H.get("H_XY")],["1,0",H.get("SQRT_X")],["1,1",H.get("SQRT_Y")],["1,2",H.get("S")],["2,0",H.get("RX")],["2,1",H.get("RY")],["2,2",H.get("R")],["3,0",H.get("MX")],["3,1",H.get("MY")],["3,2",H.get("M")],["4,0",H.get("MRX")],["4,1",H.get("MRY")],["4,2",H.get("MRZ")],["5,0",H.get("CX")],["5,1",H.get("CY")],["5,2",H.get("CZ")],["6,0",H.get("CXSWAP")],["6,1",H.get("SWAP")],["6,2",H.get("CZSWAP")],["7,0",H.get("SQRT_XX")],["7,1",H.get("SQRT_YY")],["7,2",H.get("SQRT_ZZ")],["8,0",H.get("MXX")],["8,1",H.get("MYY")],["8,2",H.get("MZZ")]]);let e=9;for(let t=0;t<4;t++)r.set(e+",0",H.get("MARKX").X(t)),r.set(e+",1",H.get("MARKY").X(t)),r.set(e+",2",H.get("MARKZ").X(t)),r.set(e+",-1",H.get("MARK").X(t)),e+=1;return r}();function Et(t){var r,e=function(t){var r,e;if(!t.ctrlKey)return r=+t.Qt.has("x"),e=+t.Qt.has("y"),t=+t.Qt.has("z"),r&&!e&&!t||!r&&e&&t?{_e:0,stre)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ngth:Math.max(r,Math.min(e,t))}:!r&&e&&!t||r&&!e&&t?{_e:1,strength:Math.max(e,Math.min(r,t))}:!r&&!e&&t||r&&e&&!t?{_e:2,strength:Math.max(t,Math.min(r,e))}:void 0}(t),t=function(i){if(!i.ctrlKey){let e=void 0;for(let r=0;r<Y.length;r++){let t=0;for(var o of Y[r].toLowerCase())t+=i.Qt.has(o.toLowerCase());t===Y[r].length&&(void 0===e||t>=e.strength)&&(e={Ee:r,strength:t/Y[r].length})}return e}}(t);let i=e,o=(void 0!==t&&void 0===e&&(r=bt[t.Ee],i=void 0===r?void 0:{strength:0,_e:r}),void 0);return void 0!==i&&void 0!==t&&(r=t.Ee+","+i._e,_t.has(r))&&(o=_t.get(r)),{Ae:e,ge:i,Se:t,ke:o}}const e=-_+Math.floor(_/4)+.5,o=-_+Math.floor(_/4)+.5;var t=document.getElementById("btnUndo"),At=document.getElementById("btnRedo"),gt=document.getElementById("btnClearMarkers");const St=document.getElementById("btnShowHideImportExport");var kt=document.getElementById("btnNextLayer"),Ct=document.getElementById("btnPrevLayer"),Pt=document.getElementById("btnRotate45"),Ot=document.getElementById("btnRotate45Counter"),v=document.get)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ElementById("btnExport"),Tt=document.getElementById("btnImport"),Dt=document.getElementById("clear");const y=document.getElementById("txtStimCircuit");var xt=document.getElementById("btnTimelineFocus"),Lt=document.getElementById("btnClearTimelineFocus"),Ut=document.getElementById("btnClearSelectedMarkers");const Ft=document.getElementById("btnShowExamples"),Gt=document.getElementById("examples-div");y.addEventListener("keyup",t=>t.stopPropagation()),y.addEventListener("keydown",t=>t.stopPropagation());let m=new class{constructor(t){this.rev=ft.kr(""),this.canvas=t,this.Wr=void 0,this.qr=void 0,this.Ce=new at,this.Gr=0,this.ce=new Map,this.ve=new Map,this.de=void 0,this.we=void 0,this.Pe=new ht(this.Oe(void 0))}Te(){for(var t=u.It(this.rev.Sr());t.yt.length<=this.Gr;)t.yt.push(new T);return t}De(){this.ce.clear(),this.xe()}Le(t){var r,e=this.Te(),i=e.Gt();for(r of this.ce.keys()){var o=i.get(r);void 0!==o&&e.yt[this.Gr].Mt(o)}this.Ue(e,t)}Fe(t){var r=this.Te();r.yt.splice(this.Gr,1),this.Ue(r,t)}Ge(t){var r=th)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(is.Te();r.yt.splice(this.Gr,0,new T),this.Ue(r,t)}Dr(){this.rev.Dr()}Lr(){this.rev.Lr()}Ue(t,r){r?this.Ne(t):this.commit(t)}commit(t){for(;0<t.yt.length&&t.yt[t.yt.length-1].ut();)t.yt.pop();this.rev.commit(t.Lt())}Ne(t){this.rev.Or(t.Lt()),this.Pe.set(this.Oe(t))}Oe(t){return void 0===t&&(t=this.Te()),new ut(t,this.Gr,this.ce,this.ve,this.qr,this.Wr,this.de,this.we,this.ze(this.Ce.$t.has("alt")))}xe(){var t=this.Pe.get().Hr;this.Pe.set(this.Oe(t))}Qe(){this.commit(new u(new Float64Array([]),[]))}$e(){var t,r=this.Te();for(t of r.yt)t.it=t.it.filter(t=>"MARKX"!==t.Z.name&&"MARKY"!==t.Z.name&&"MARKZ"!==t.Z.name);this.commit(r)}ze(i){var t=this.qr,r=this.Wr,o=this.de,a=this.we,n=[];if(void 0!==t&&void 0!==o){var[s,h]=vt(o,a),f=Math.min(t,o),l=Math.max(t,o),v=Math.min(r,a),c=Math.max(r,a),t=_/4-Yt;f+=t,l-=t,v+=t,c-=t,f=Math.floor(2*f/_+.5)/2,l=Math.floor(2*l/_+.5)/2,v=Math.floor(2*v/_+.5)/2,c=Math.floor(2*c/_+.5)/2;let e=1;f!=l&&v!=c||(e=2);for(let r=f;r<=l;r+=.5)for(let t=v;t<=c;t+=.5)r%1!=t%1||i&&(s%e!=r%e||h%)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(e!=t%e)||n.push([r,t])}return n}Ke(o,t,r){let e=this.Te();e=e.gt(o),!t&&r&&(this.ve=(r=t=>{var r,e,i=new Map;for([r,e]of t.values())[r,e]=o(r,e),i.set(r+","+e,[r,e]);return i})(this.ve),this.ce=r(this.ce)),this.Ue(e,t)}Be(t,r){let e=Mt(t),i=this.Te().gt(e).St();this.Ke((t,r)=>([t,r]=e(t,r),i(t,r)),r,!0)}He(t){this.Gr=Math.max(t,0),this.xe()}qe(t,r,e){r||e||this.ce.clear();for(var[i,o]of t){var a=i+","+o;e&&this.ce.has(a)?this.ce.delete(a):this.ce.set(a,[i,o])}this.xe()}We(t){var r,e=new Map,i=this.Te().yt[this.Gr];for(r of[...t]){var o=i.et.get(r);if(void 0!==o)if("RX"===o.Z.name||"MX"===o.Z.name||"MRX"===o.Z.name)e.set(r,"X");else if("RY"===o.Z.name||"MY"===o.Z.name||"MRY"===o.Z.name)e.set(r,"Y");else if("R"===o.Z.name||"M"===o.Z.name||"MR"===o.Z.name)e.set(r,"Z");else if("MXX"===o.Z.name||"MYY"===o.Z.name||"MZZ"===o.Z.name){var a,n=o.Z.name[1];for(a of o.Y)e.set(a,n)}else if(o.Z.name.startsWith("MPP:")&&void 0===o.Z.h&&o.Y.length===o.Z.name.length-4){var s=o.Z.name.substring(4);for(let t=0;t<o.Y.length;t++))CRUMBLE_PART");
    result.append(R"CRUMBLE_PART({var h=o.Y[t];e.set(h,s[t])}}}return e}Ve(t,r){var e,i=this.Te().Ft(this.ce.values()),o=i.Gt(),a=new Set;for(e of this.ce.keys())a.add(o.get(e));var n,s=this.We(a);for(n of s.keys())a.add(n);var h=new Set(s.values());h.delete(void 0);let f;f=1===h.size?[...h][0]:"Z";var l,v=i.yt[this.Gr];for(l of a){let t=s.get(l);void 0===t&&(t=f);var c=H.get("MARK"+t).X(r);v.put(new O(c,new Float32Array([r]),new Uint32Array([l])))}this.Ue(i,t)}je(t){var r,e,i,o=this.Te().Ft(this.ce.values()),a=o.Gt(),n=new Set;for(r of this.ce.keys())n.add(a.get(r));for(e of this.We(n).keys())n.add(e);for(i of n)void 0!==i&&o.yt[this.Gr].Xt(i);this.Ue(o,t)}Je(t,r,e){var i,o=this.Te().Ft(this.ce.values()),a=o.Gt();for(i of this.ce.keys())o.yt[this.Gr].put(new O(r,new Float32Array(e),new Uint32Array([a.get(i)])));this.Ue(o,t)}ti(t,r,e){let i=this.Te();var[o,a]=vt(this.qr,this.Wr),[n,s]=G(this.ce.values()),h=[];if(void 0===o||void 0===n||this.ce.has(o+","+a)){if(2===this.ce.size)for(var[f,l]of this.ce.values())h.push([f,l])}else{var v,c,d=o-n,)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(w=a-s;for([v,c]of this.ce.values())h.push([v,c]),h.push([v+d,c+w])}if(0<h.length){var u=(i=i.Ft(h)).Gt();for(let t=0;t<h.length;t+=2){var[M,X]=h[t],[Z,R]=h[t+1],M=u.get(M+","+X),X=u.get(Z+","+R);i.yt[this.Gr].put(new O(r,new Float32Array(e),new Uint32Array([M,X])))}}this.Ue(i,t)}ri(t,r,e){if(0!==this.ce.size){var i,n=[];let o=0,a=0;for(i of this.ce.values())n.push(i),o+=i[0],a+=i[1];o/=n.length,a/=n.length,n.sort((t,r)=>{var[t,e]=t,[r,i]=r;return Math.atan2(e-a,t-o)-Math.atan2(i-a,r-o)});var s=this.Te().Ft(this.ce.values()),h=s.Gt(),f=new Uint32Array(this.ce.size);for(let t=0;t<n.length;t++){var[l,v]=n[t];f[t]=h.get(l+","+v)}s.yt[this.Gr].put(new O(r,new Float32Array(e),f)),this.Ue(s,t)}}ei(t,r,e=void 0){void 0===e&&(e=void 0===r.M?[]:[r.M]),1===r.t?this.Je(t,r,e):2===r.t?this.ti(t,r,e):this.ri(t,r,e)}ii(t,r){this.oi(t,r,!1)}ai(t,r){this.oi(t,r,!0)}oi(t,r,e){var i=this.Te(),o=e?i.Pt(!1).Dt.length:r,a=E.fe(i,r);for(let t=0;t<i.yt.length;t++){var n,s=0===t?new Z(new Map,new Set,[]):a.Nr(t-.5),h=a.Nr(t+.5),f=i.y)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(t[t];for(n of new Set([...s.zr.keys(),...h.zr.keys()])){var l=s.zr.get(n),v=h.zr.get(n),c=f.et.get(n),d=void 0!==c?c.Z.name:void 0;let t=void 0;"MR"===d||"MRX"===d||"MRY"===d?t=l:void 0!==c&&0<c.m()&&(void 0===l?t=v:void 0===v?t=l:l!==v&&((d=new Set(["X","Y","Z"])).delete(l),d.delete(v),t=[...d][0])),void 0!==t&&f.it.push(new O(H.get(e?"DETECTOR":"OBSERVABLE_INCLUDE"),new Float32Array([o]),c.Y))}f.it=f.it.filter(t=>!t.Z.name.startsWith("MARK")||t.R[0]!==r)}this.Ue(i,t)}ni(t,i){let n=this.Te(),s=new Set;var r,e=n.Gt();for(r of this.ce.keys())s.add(e.get(r));var o=(()=>{var t,r,{Dt:e,xt:i}=n.Pt(!1);for(let t=0;t<e.length;t++){var o=E.le(n,e[t].Tt);if(o.Nr(this.Gr+.5).ne(s))return[o,new O(H.get("DETECTOR"),new Float32Array([t]),new Uint32Array([]))]}for([t,r]of i.entries()){var a=E.le(n,r);if(a.Nr(this.Gr+.5).ne(s))return[a,new O(H.get("OBSERVABLE_INCLUDE"),new Float32Array([t]),new Uint32Array([]))]}})();if(void 0!==o){let[r,e]=o;var a=this.Te();for(let t=0;t<a.yt.length;t++){var h,f=0===t?new Z(new Map,new Set)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(,[]):r.Nr(t-.5),l=r.Nr(t+.5),v=a.yt[t];for(h of new Set([...f.zr.keys(),...l.zr.keys()])){var c=f.zr.get(h),d=l.zr.get(h),w=v.et.get(h),u=void 0!==w?w.Z.name:void 0;let t=void 0;"MR"===u||"MRX"===u||"MRY"===u||"R"===u||"RX"===u||"RY"===u?t=d:void 0!==w&&0<w.m()&&(void 0===c?t=d:void 0===d?t=c:c!==d&&((u=new Set(["X","Y","Z"])).delete(c),u.delete(d),t=[...u][0])),void 0!==t&&v.it.push(new O(H.get("MARK"+t),new Float32Array([i]),new Uint32Array([h])))}v.it=v.it.filter(t=>t.Z.name!==e.Z.name||t.R[0]!==e.R[0])}this.Ue(a,t)}}}(document.getElementById("cvn"));function Nt(){var t=m.Te().Lt().replaceAll("\nPOLYGON","\n#!pragma POLYGON").replaceAll("\nMARK","\n#!pragma MARK"),r=y;r.value=t+"\n",r.focus(),r.select()}v.addEventListener("click",t=>{Nt()}),Tt.addEventListener("click",t=>{var r=y.value,r=u.It(r);m.commit(r)}),St.addEventListener("click",t=>{var r=document.getElementById("divImportExport");"none"===r.style.display?(r.style.display="block",St.textContent="Hide Import/Export",Nt()):(r.style.display="none",St.)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(textContent="Show Import/Export",y.value=""),setTimeout(()=>{window.scrollTo(0,0)},0)}),Dt.addEventListener("click",t=>{m.Qe()}),t.addEventListener("click",t=>{m.Dr()}),xt.addEventListener("click",t=>{m.ve=new Map(m.ce.entries()),m.xe()}),Ut.addEventListener("click",t=>{m.je(!1),m.xe()}),Ft.addEventListener("click",t=>{"none"===Gt.style.display?(Gt.style.display="block",Ft.textContent="Hide Example Circuits"):(Gt.style.display="none",Ft.textContent="Show Example Circuits")}),Lt.addEventListener("click",t=>{m.ve=new Map,m.xe()}),At.addEventListener("click",t=>{m.Lr()}),gt.addEventListener("click",t=>{m.$e()}),Pt.addEventListener("click",t=>{m.Be(1,!1)}),Ot.addEventListener("click",t=>{m.Be(-1,!1)}),kt.addEventListener("click",t=>{m.He(m.Gr+1)}),Ct.addEventListener("click",t=>{m.He(m.Gr-1)}),window.addEventListener("resize",t=>{m.canvas.width=m.canvas.scrollWidth,m.canvas.height=m.canvas.scrollHeight,m.xe()}),m.canvas.addEventListener("mousemove",t=>{m.qr=t.offsetX+e,m.Wr=t.offsetY+o;var r=m.canvas.width/2;zt&&)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(1===t.buttons?m.He(Math.floor((t.offsetX-r)/8)):m.xe()});let zt=!1;m.canvas.addEventListener("mousedown",t=>{m.qr=t.offsetX+e,m.Wr=t.offsetY+o,m.de=t.offsetX+e,m.we=t.offsetY+o;var r=m.canvas.width/2;(zt=t.offsetY<20&&t.offsetX>r&&1===t.buttons)?m.He(Math.floor((t.offsetX-r)/8)):m.xe()}),m.canvas.addEventListener("mouseup",t=>{var r=m.ze(t.altKey);m.de=void 0,m.we=void 0,m.qr=t.offsetX+e,m.Wr=t.offsetY+o,m.qe(r,t.shiftKey,t.ctrlKey),1===t.buttons&&(zt=!1)});let Qt=void 0;async function $t(){let e=m.Te();e.yt=[e.yt[m.Gr]],0<m.ce.size&&(e.yt[0]=e.yt[0].dt(t=>{var r=e.Yt[2*t],t=e.Yt[2*t+1];return m.ce.has(r+","+t)}),[r,t]=G(m.ce.values()),e=e.Ct(-r,-t));var t,r=e.Lt();Qt=r;try{await navigator.clipboard.writeText(r)}catch(t){console.warn("Failed to write to clipboard. Using fallback emulated clipboard.",t)}}async function Kt(e){let i;try{i=await navigator.clipboard.readText()}catch(t){console.warn("Failed to read from clipboard. Using fallback emulated clipboard.",t),i=Qt}if(void 0!==i){let r=u.It(i);if(1!==r.yt.)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(length)throw new Error(i);let t=m.Te();0<m.ce.size&&([o,a]=G(m.ce.values()),r=r.Ct(o,a));var o,a,n=[];for(let t=0;t<r.Yt.length;t+=2)n.push([r.Yt[t],r.Yt[t+1]]);var s,h,f=(t=t.Ft(n)).Gt();for(s of m.ce.keys()){var l=f.get(s);void 0!==l&&t.yt[m.Gr].Mt(l)}for(h of r.yt[0].nt()){var v,c=[];for(v of h.Y){var d=r.Yt[2*v],w=r.Yt[2*v+1];c.push(f.get(d+","+w))}t.yt[m.Gr].put(new O(h.Z,h.R,new Uint32Array(c)))}m.Ue(t,e)}}const Bt=function(){let o=new Map;o.set("shift+t",t=>m.Be(-1,t)),o.set("t",t=>m.Be(1,t)),o.set("escape",()=>m.De),o.set("delete",t=>m.Le(t)),o.set("backspace",t=>m.Le(t)),o.set("ctrl+delete",t=>m.Fe(t)),o.set("ctrl+insert",t=>m.Ge(t)),o.set("ctrl+backspace",()=>m.Fe),o.set("ctrl+z",t=>{t||m.Dr()}),o.set("ctrl+y",t=>{t||m.Lr()}),o.set("ctrl+shift+z",t=>{t||m.Lr()}),o.set("ctrl+c",async t=>{await $t()}),o.set("ctrl+v",Kt),o.set("ctrl+x",async t=>{var r;await $t(),0===m.ce.size?((r=m.Te()).yt[m.Gr].et.clear(),r.yt[m.Gr].it.length=0,m.Ue(r,t)):m.Le(t)}),o.set("l",t=>{t||(m.ve=new Map(m.ce.entries()),m.xe()CRUMBLE_PART");
    result.append(R"CRUMBLE_PART())}),o.set(" ",t=>m.je(t));for(let[t,r]of[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9],["-",10],["=",11],["\\",12],["`",13]])o.set(""+t,t=>m.Ve(t,r)),o.set(t+"+x",t=>m.ei(t,H.get("MARKX").X(r))),o.set(t+"+y",t=>m.ei(t,H.get("MARKY").X(r))),o.set(t+"+z",t=>m.ei(t,H.get("MARKZ").X(r))),o.set(t+"+d",t=>m.ai(t,r)),o.set(t+"+o",t=>m.ii(t,r)),o.set(t+"+j",t=>m.ni(t,r));let r=.25;function a(t,r,e=void 0){for(var i of t){if(o.has(i))throw new Error("Chord collision: "+i);o.set(i,t=>m.ei(t,H.get(r)))}void 0!==e&&a(t.map(t=>"shift+"+t),e)}return o.set("p",t=>m.ei(t,H.get("POLYGON"),[1,0,0,r])),o.set("alt+p",t=>m.ei(t,H.get("POLYGON"),[0,1,0,r])),o.set("shift+p",t=>m.ei(t,H.get("POLYGON"),[0,0,1,r])),o.set("p+x",t=>m.ei(t,H.get("POLYGON"),[1,0,0,r])),o.set("p+y",t=>m.ei(t,H.get("POLYGON"),[0,1,0,r])),o.set("p+z",t=>m.ei(t,H.get("POLYGON"),[0,0,1,r])),o.set("p+x+y",t=>m.ei(t,H.get("POLYGON"),[1,1,0,r])),o.set("p+x+z",t=>m.ei(t,H.get("POLYGON"),[1,0,1,r])),o.set("p+y+z",t=>m.ei(t,H.get(")CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(POLYGON"),[0,1,1,r])),o.set("p+x+y+z",t=>m.ei(t,H.get("POLYGON"),[1,1,1,r])),o.set("m+p+x",t=>m.ei(t,l("X".repeat(m.ce.size)),[])),o.set("m+p+y",t=>m.ei(t,l("Y".repeat(m.ce.size)),[])),o.set("m+p+z",t=>m.ei(t,l("Z".repeat(m.ce.size)),[])),o.set("f",t=>{var r,e,i,o=m.Te(),a=o.yt[m.Gr],n=new Set,s=new Map;for(r of[["CX","reverse"],["CY","reverse"],["XCY","reverse"],["CXSWAP","reverse"],["XCZ","reverse"],["XCY","reverse"],["YCX","reverse"],["SWAPCX","reverse"],["RX","MX"],["R","M"],["RY","MY"]])s.set(r[0],r[1]),s.set(r[1],r[0]);for(e of m.ce.keys()){var h=a.et.get(o.Gt().get(e));void 0!==h&&s.has(h.Z.name)&&n.add(h.Y[0])}for(i of n){var f=a.et.get(i),l=s.get(f.Z.name);"reverse"===l?a.et.get(i).Y.reverse():f.Z=H.get(l)}m.Ue(o,t)}),o.set("g",t=>{var r=m.Te();let e=m.Gr;for(;e<r.yt.length&&!r.yt[e].empty();)e+=1;var i=[];for(let t=m.Gr;t<e;t++)i.push(r.yt[t]);i.reverse();for(let t=m.Gr;t<e;t++)r.yt[t]=i[t-m.Gr];m.Ue(r,t)}),o.set("shift+>",t=>m.Ke((t,r)=>[t+1,r],t,!1)),o.set("shift+<",t=>m.Ke((t,r)=>[t-1,r],t,!1)),o)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(.set("shift+v",t=>m.Ke((t,r)=>[t,r+1],t,!1)),o.set("shift+^",t=>m.Ke((t,r)=>[t,r-1],t,!1)),o.set(">",t=>m.Ke((t,r)=>[t+1,r],t,!1)),o.set("<",t=>m.Ke((t,r)=>[t-1,r],t,!1)),o.set("v",t=>m.Ke((t,r)=>[t,r+1],t,!1)),o.set("^",t=>m.Ke((t,r)=>[t,r-1],t,!1)),o.set(".",t=>m.Ke((t,r)=>[t+.5,r+.5],t,!1)),a(["h","h+y","h+x+z"],"H","H"),a(["h+z","h+x+y"],"H_XY","H_XY"),a(["h+x","h+y+z"],"H_YZ","H_YZ"),a(["s+x","s+y+z"],"SQRT_X","SQRT_X_DAG"),a(["s+y","s+x+z"],"SQRT_Y","SQRT_Y_DAG"),a(["s","s+z","s+x+y"],"S","S_DAG"),a(["r+x","r+y+z"],"RX"),a(["r+y","r+x+z"],"RY"),a(["r","r+z","r+x+y"],"R"),a(["m+x","m+y+z"],"MX"),a(["m+y","m+x+z"],"MY"),a(["m","m+z","m+x+y"],"M"),a(["m+r+x","m+r+y+z"],"MRX"),a(["m+r+y","m+r+x+z"],"MRY"),a(["m+r","m+r+z","m+r+x+y"],"MR"),a(["c"],"CX","CX"),a(["c+x"],"CX","CX"),a(["c+y"],"CY","CY"),a(["c+z"],"CZ","CZ"),a(["j+x"],"X","X"),a(["j+y"],"Y","Y"),a(["j+z"],"Z","Z"),a(["c+x+y"],"XCY","XCY"),a(["alt+c+x"],"XCX","XCX"),a(["alt+c+y"],"YCY","YCY"),a(["w"],"SWAP","SWAP"),a(["w+x"],"CXSWAP",void 0),a(["c)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(+w+x"],"CXSWAP",void 0),a(["i+w"],"ISWAP","ISWAP_DAG"),a(["w+z"],"CZSWAP",void 0),a(["c+w+z"],"CZSWAP",void 0),a(["c+w"],"CZSWAP",void 0),a(["c+t"],"C_XYZ","C_ZYX"),a(["c+s+x"],"SQRT_XX","SQRT_XX_DAG"),a(["c+s+y"],"SQRT_YY","SQRT_YY_DAG"),a(["c+s+z"],"SQRT_ZZ","SQRT_ZZ_DAG"),a(["c+s"],"SQRT_ZZ","SQRT_ZZ_DAG"),a(["c+m+x"],"MXX","MXX"),a(["c+m+y"],"MYY","MYY"),a(["c+m+z"],"MZZ","MZZ"),a(["c+m"],"MZZ","MZZ"),o}();function Ht(r){if(m.Ce.jt(r),"keydown"===r.type){if("q"===r.key.toLowerCase())return e=r.shiftKey?5:1,void m.He(m.Gr-e);if("e"===r.key.toLowerCase())return e=r.shiftKey?5:1,void m.He(m.Gr+e);if("Home"===r.key)return m.He(0),void r.preventDefault();if("End"===r.key)return m.He(m.Te().yt.length-1),void r.preventDefault()}var t=m.Ce.Ht;if(0!==t.length){for(var e=t[t.length-1];0<t.length;)t.pop();var i=[...e.Qt];if(0!==i.length){i.sort();let t="";e.altKey&&(t+="alt+"),e.ctrlKey&&(t+="ctrl+"),e.metaKey&&(t+="meta+"),e.shiftKey&&(t+="shift+");for(var o of i)t+=o+"+";t=t.substring(0,t.length-1);i=Bt.get(t);voi)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(d 0!==i?(i(e.zt),r.preventDefault()):m.Ne(m.Te())}}}document.addEventListener("keydown",Ht),document.addEventListener("keyup",Ht),m.canvas.width=m.canvas.scrollWidth,m.canvas.height=m.canvas.scrollHeight,m.rev.Ar().subscribe(()=>{m.Pe.set(m.Oe(void 0));var t=m.Ce.qt(!1),a=(r.width=r.scrollWidth,r.height=r.scrollHeight,r.getContext("2d"));a.clearRect(0,0,r.width,r.height),a.textAlign="right",a.textBaseline="middle",a.fillText("X",7.5,24.5),a.fillText("Y",7.5,56.5),a.fillText("Z",7.5,88.5),a.textAlign="center",a.textBaseline="bottom";for(let t=0;t<Y.length;t++)a.fillText(Y[t],24.5+32*t,R);a.fillStyle="white",a.strokeStyle="black";var e=[["H_YZ","S_X","R_X","M_X","MR_X","C_X","CXSWAP","√XX","M_XX","PX","X1"],["H","S_Y","R_Y","M_Y","MR_Y","C_Y","SWAP","√YY","M_YY","PY","Y1"],["H_XY","S","R","M","MR","C_Z","CZSWAP","√ZZ","M_ZZ","PZ","Z1"]];for(let r=0;r<Y.length;r++)for(let t=0;t<3;t++)a.fillRect(R+32*r,R+32*t,28,28);for(let r=0;r<Y.length;r++)for(let t=0;t<3;t++){var n=e[t][r];let i=R+32*r+14,o=R+32*t+14;if(n.sta)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(rtsWith("P")){a.beginPath();let r=3;"PX"===n?(r=4,a.fillStyle="red"):"PY"===n?(r=5,a.fillStyle="green",o+=1):"PZ"===n&&(r=3,a.fillStyle="blue",o+=2);var s,h=[];for(let t=0;t<r;t++){var f=2*Math.PI/r*(t+.5);h.push([Math.round(i+8.4*Math.sin(f)),Math.round(o+8.4*Math.cos(f))])}a.moveTo(h[h.length-1][0],h[h.length-1][1]);for(s of h)a.lineTo(s[0],s[1]);a.closePath(),a.globalAlpha*=.25,a.fill(),a.globalAlpha*=4}else if(n.endsWith("1")){a.beginPath(),a.moveTo(i+4.8,o-8),a.lineTo(i,o+3.2),a.lineTo(i-4.8,o-8),a.closePath();var l="X1"===n?"red":"Y1"===n?"green":"blue";a.fillStyle=l,a.strokeStyle=l,a.fill(),a.lineWidth=2,a.beginPath(),a.moveTo(i,o),a.lineTo(i+14,o),a.stroke(),a.lineWidth=1}else if(a.fillStyle="black",-1!==n.indexOf("_")){var[v,c]=n.split("_");let t=16,r=0,e=0;for(;4<t&&(a.font=t+"pt monospace",r=a.measureText(v).width,a.font=.6*t+"pt monospace",e=a.measureText(c).width,!(r+e<=26));)--t;i-=(r+e)/2,a.font=t+"pt monospace",a.textAlign="left",a.textBaseline="middle",a.fillText(v,i,o),a.font=.6*t+"pt monosp)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(ace",a.textAlign="left",a.textBaseline="top",a.fillText(c,i+r,o)}else{let t=16;for(;4<t&&(a.font=t+"pt monospace",!(a.measureText(n).width<=28));)--t;a.textAlign="center",a.textBaseline="middle",a.fillText(n,i,o)}}a.strokeStyle="black";for(let r=0;r<Y.length;r++)for(let t=0;t<3;t++)a.strokeRect(R+32*r,R+32*t,28,28);void 0!==(t=Et(t)).Ae&&(a.fillStyle="rgba(255, 255, 0, "+.5*t.Ae.strength+")",a.fillRect(0,R+32*t.Ae._e-2,R+32*Y.length,32)),void 0!==t.Se&&(a.fillStyle="rgba(255, 255, 0, "+.5*t.Se.strength+")",a.fillRect(R+32*t.Se.Ee-2,0,32,106.5)),void 0!==t.ge&&void 0!==t.Se&&(a.fillStyle="rgba(255, 0, 0, 0.5)",a.fillRect(R+32*t.Se.Ee-2,R+32*t.ge._e-2,32,32)),a.textAlign="left",a.textBaseline="middle",a.fillStyle="black"});{var qt=m.rev;const I=new Zt;v=()=>{try{var t,r=(()=>{var t=document.location.hash.substring(1),r=new Map;if(""!==t)for(var e of t.split("&")){var i,o=e.indexOf("=");-1!==o&&(i=e.substring(0,o),e=decodeURIComponent(e.substring(o+1)),r.set(i,e))}return r})(),e=(r.has("circuit")||("[[[DEFAULT-C)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(IRCUIT-CONTENT-LITERAL]]]"===(t=document.getElementById("txtDefaultCircuit")).value.replaceAll("_","-")?r.set("circuit",""):r.set("circuit",t.value)),u.It(r.get("circuit"))),i=e.Lt();qt.clear(i),e.yt.every(t=>t.ut())&&1===r.size&&i===r.get("circuit")?I.me():I.Ie(i,Rt(i))}catch(t){throw new Error(t)}},window.addEventListener("popstate",v),v(),qt.gr().Rr().Zr(1).subscribe(t=>{I.Ie(t,Rt(t))})}m.Pe.mr().subscribe(t=>requestAnimationFrame(()=>wt(m.canvas.getContext("2d"),t))),window.addEventListener("focus",()=>{m.Ce.Vt()}),window.addEventListener("blur",()=>{m.Ce.Vt()});for(let r of document.getElementById("examples-div").querySelectorAll("a"))r.onclick=t=>{if(!(t.shiftKey||t.ctrlKey||t.altKey||0!==t.button))return t=r.href.split("#circuit=")[1],m.rev.commit(t),!1};
)CRUMBLE_PART");
    result.append(R"CRUMBLE_PART(</script>
)CRUMBLE_PART");
    return result;
}
